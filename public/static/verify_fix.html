<!DOCTYPE html>
<html>
<head>
    <title>Verify Chat Fix</title>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; direction: rtl; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; font-size: 16px; }
        #result { border: 1px solid #ccc; padding: 10px; min-height: 100px; margin: 10px 0; background: #f9f9f9; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h2>×‘×“×™×§×ª ×ª×™×§×•×Ÿ ×”×¦'××˜</h2>
    
    <button onclick="testChatFix()">×‘×“×•×§ ×ª×™×§×•×Ÿ ×”×¦'××˜</button>
    <button onclick="clearResults()">× ×§×” ×ª×•×¦××•×ª</button>
    
    <div id="result">×œ×—×¥ ×¢×œ ×”×›×¤×ª×•×¨ ×›×“×™ ×œ×‘×“×•×§ ××ª ×”×ª×™×§×•×Ÿ...</div>
    
    <script>
        async function testChatFix() {
            const result = document.getElementById('result');
            result.innerHTML = 'ğŸ”„ ×©×•×œ×— ×‘×§×©×ª ×‘×“×™×§×”...<br>';
            
            try {
                const response = await axios.post('/api/chat', {
                    message: '×‘×“×™×§×ª ×ª×™×§×•×Ÿ ×”×¦\'××˜',
                    userType: 'call_center',
                    history: []
                });
                
                console.log('×ª×’×•×‘×ª ×”×©×¨×ª:', response.data);
                
                if (response.data && response.data.response) {
                    result.innerHTML = `
                        <div class="success">âœ… ×”×ª×™×§×•×Ÿ ×¢×•×‘×“ ×‘×”×¦×œ×—×”!</div>
                        <br><strong>×ª×’×•×‘×ª ×”×¦'××˜×‘×•×˜:</strong><br>
                        <div style="background: white; padding: 10px; border: 1px solid #ddd; margin: 10px 0;">
                            ${response.data.response.substring(0, 300)}...
                        </div>
                        <br><strong>×¤×¨×˜×™× ×˜×›× ×™×™×:</strong><br>
                        ×¡×˜×˜×•×¡: ${response.status}<br>
                        ×¡×•×’ ××©×ª××©: ${response.data.userType}<br>
                        ×–××Ÿ: ${response.data.timestamp}
                    `;
                } else {
                    result.innerHTML = `
                        <div class="error">âŒ ×ª×’×•×‘×” ×œ× ×ª×§×™× ×” ××”×©×¨×ª</div>
                        <br>×”×ª×’×•×‘×”: ${JSON.stringify(response.data)}
                    `;
                }
                
            } catch (error) {
                console.error('×©×’×™××”:', error);
                result.innerHTML = `
                    <div class="error">âŒ ×©×’×™××” ×‘×‘×“×™×§×”: ${error.message}</div>
                    <br>×¤×¨×˜×™ ×”×©×’×™××”: ${error.response ? error.response.status + ' - ' + error.response.statusText : '×©×’×™××ª ×¨×©×ª'}
                `;
            }
        }
        
        function clearResults() {
            document.getElementById('result').innerHTML = '×”×ª×•×¦××•×ª × ×•×§×•. ×œ×—×¥ ×¢×œ ×”×›×¤×ª×•×¨ ×›×“×™ ×œ×‘×“×•×§ ×©×•×‘...';
        }
        
        console.log('ğŸŸ¢ ×¢××•×“ ×‘×“×™×§×ª ×”×ª×™×§×•×Ÿ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”');
    </script>
</body>
</html>
