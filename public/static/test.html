<!DOCTYPE html>
<html>
<head>
    <title>Test Chat Functions</title>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
</head>
<body>
    <textarea id="chat-input" placeholder="Test input"></textarea>
    <button id="send-button" onclick="sendMessage()">Send</button>
    <button onclick="sendQuickMessage('test message')">Quick Action</button>
    
    <div id="chat-messages"></div>
    
    <script>
        // Copy key functions from app.js for testing
        let isTyping = false;
        let messageHistory = [];
        let currentUser = 'call_center';
        
        function sendQuickMessage(message) {
            console.log('ğŸš€ Quick message function called with:', message);
            const textarea = document.getElementById('chat-input');
            if (textarea) {
                textarea.value = message;
                console.log('âœ… Message inserted to textarea');
                sendMessage();
            } else {
                console.error('âŒ Textarea not found');
            }
        }
        
        async function sendMessage() {
            console.log('ğŸ”„ sendMessage called');
            const textarea = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-button');
            
            console.log('ğŸ” textarea:', textarea ? 'âœ… Found' : 'âŒ Not found');
            console.log('ğŸ” sendButton:', sendButton ? 'âœ… Found' : 'âŒ Not found');
            
            if (!textarea || isTyping) {
                console.log('âŒ Early exit from sendMessage');
                return;
            }
            
            const message = textarea.value.trim();
            console.log('ğŸ“ Message:', message);
            if (!message) {
                console.log('âŒ Empty message');
                return;
            }
            
            isTyping = true;
            console.log('ğŸŒ Sending request to server...');
            
            try {
                const response = await axios.post('/api/chat', {
                    message: message,
                    userType: currentUser,
                    history: messageHistory.slice(-5)
                });
                
                console.log('âœ… Response received:', response.status);
                console.log('ğŸ“¦ Response data:', response.data);
                alert('Success! Response: ' + JSON.stringify(response.data.response).substring(0, 100) + '...');
                
            } catch (error) {
                console.error('âŒ Error:', error);
                alert('Error: ' + error.message);
            } finally {
                isTyping = false;
                textarea.value = '';
            }
        }
        
        console.log('ğŸŸ¢ Test page loaded');
    </script>
</body>
</html>
