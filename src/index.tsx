import { Hono } from 'hono'
import { cors } from 'hono/cors'
import { renderer } from './renderer'

const app = new Hono()

// Enable CORS for API routes
app.use('/api/*', cors())
app.use(renderer)

// Simulated knowledge base
const knowledgeBase = [
  {
    id: 1,
    category: "××•×§×“ ×˜×œ×¤×•× ×™",
    question: "××” ×”× ×•×”×œ ×œ×˜×™×¤×•×œ ×‘×¤× ×™×™×ª ×œ×§×•×— ×¢×œ ×—×™×•×‘ ×¢××œ×” ×œ× ××•×¦×“×§?",
    answer: "×¢×œ ×¤×™ × ×•×”×œ ×˜×™×¤×•×œ ×‘×¤× ×™×•×ª ×¢××œ×•×ª (××¡' 205.12), ×™×© ×œ×‘×¦×¢: 1. ×‘×“×™×§×ª ×”×—×™×•×‘ ×‘××¢×¨×›×ª CRM 2. ××™××•×ª ×–×›××•×ª ×”×œ×§×•×— ×œ×–×™×›×•×™ (×¢×“ 50 â‚ª ×œ×œ×§×•×— ××“×•×¨×’) 3. ×‘×™×¦×•×¢ ×–×™×›×•×™ ××™×™×“×™ ××• ×”×¡×œ××” ×œ×× ×”×œ ××©××¨×ª.",
    sources: ["× ×•×”×œ 205.12", "××“×™× ×™×•×ª ×©×™×¨×•×ª ×œ×§×•×—×•×ª"],
    lastUpdated: "2024-10-15",
    accessLevel: "basic"
  },
  {
    id: 2,
    category: "×¢×•×‘×“ ×¡× ×™×£",
    question: "××”× ×”×§×¨×™×˜×¨×™×•× ×™× ×œ××™×©×•×¨ ×”×œ×•×•××” ×¢×¡×§×™×ª ×©×œ 500,000 ×©\"×—?",
    answer: "×¢×œ ×¤×™ ××“×™× ×™×•×ª ××©×¨××™ ×¢×¡×§×™ (××¡' 301.08), ×”×œ×•×•××” ×‘×¡×›×•× ×–×” ×“×•×¨×©×ª: 1. ×•×ª×§ ×¢×¡×§×™ ××™× ×™××œ×™ ×©×œ 2 ×©× ×™× 2. ××—×–×•×¨ ×©× ×ª×™ ××™× ×™××œ×™ ×©×œ 2 ××™×œ×™×•×Ÿ ×©\"×— 3. ×“×•×—×•×ª ×›×¡×¤×™×™× ××‘×•×§×¨×™× 4. ×¢×¨×‘×•×™×•×ª ×‘×”×ª×× ×œ×¡×™×›×•×Ÿ. × ×“×¨×©×ª ×”×¤× ×™×” ×œ×•×•×¢×“×ª ××©×¨××™ ×¡× ×™×¤×™×ª.",
    sources: ["××“×™× ×™×•×ª ××©×¨××™ 301.08", "× ×¡×¤×— ×‘' - ×§×¨×™×˜×¨×™×•× ×™×"],
    lastUpdated: "2024-10-10",
    accessLevel: "branch"
  },
  {
    id: 3,
    category: "××¤×ª×— ×ª×•×›× ×”",
    question: "××™×š ××’×™×©×™× ×‘×§×©×” ×œ×’×™×©×” ×œ××¢×¨×›×ª ×”×œ×™×‘×” ×”×—×“×©×”?",
    answer: "×ª×”×œ×™×š ×‘×§×©×ª ×’×™×©×” ×œ××¢×¨×›×ª Core Banking v3.0: 1. ××™×œ×•×™ ×˜×•×¤×¡ IT-403 ×‘××¢×¨×›×ª ServiceNow 2. ××™×©×•×¨ ×× ×”×œ ×™×©×™×¨ ×•×× ×”×œ ××‘×˜×—×ª ××™×“×¢ 3. ×”×©×œ××ª ×§×•×¨×¡ ××‘×˜×—×” S-205 4. ×–××Ÿ ×˜×™×¤×•×œ: ×¢×“ 5 ×™××™ ×¢×¡×§×™×.",
    sources: ["××“×¨×™×š IT Procedures", "ServiceNow KB-1205"],
    lastUpdated: "2024-10-12",
    accessLevel: "tech"
  },
  {
    id: 4,
    category: "×›×œ×œ×™",
    question: "××”×Ÿ ×©×¢×•×ª ×”×¤×¢×™×œ×•×ª ×©×œ ××¢×¨×›×•×ª ×”×‘× ×§?",
    answer: "××¢×¨×›×•×ª ×”×œ×™×‘×” ×¤×•×¢×œ×•×ª: ×¨××©×•×Ÿ-×—××™×©×™ 06:00-23:00, ×©×™×©×™ 06:00-15:00. ××¢×¨×›×•×ª ××©× ×” ×–××™× ×•×ª 24/7. ×‘×™××™ ×—×’ ×™×™×ª×›× ×• ×”×¤×¡×§×•×ª ××ª×•×›× × ×•×ª - ×¨××” ×œ×•×— ×”×©×™×¨×•×ª ×”×©×‘×•×¢×™.",
    sources: ["×œ×•×— ×©×™×¨×•×ª IT", "× ×•×”×œ ×ª×¤×¢×•×œ ××¢×¨×›×•×ª"],
    lastUpdated: "2024-10-08",
    accessLevel: "basic"
  },
  {
    id: 5,
    category: "××©××‘×™ ×× ×•×©",
    question: "××”×Ÿ ×©×¢×•×ª ×”×¢×‘×•×“×” ×”×¨×’×™×œ×•×ª ×‘×‘× ×§ ×™×©×¨××œ?",
    answer: "×¢×œ ×¤×™ × ×•×”×œ ×©×¢×•×ª ×¢×‘×•×“×” (××¡' HR-101.05): **××©×¨×“×™ ×”× ×”×œ×” ×•×—×˜×™×‘×•×ª ××˜×”:** ×¨××©×•×Ÿ-×—××™×©×™ 08:00-17:00 (8.5 ×©×¢×•×ª ×¢× ×”×¤×¡×§×ª ×¦×”×¨×™×™×). **×¡× ×™×¤×™×:** ×¨××©×•×Ÿ, ×©×œ×™×©×™, ×—××™×©×™ 08:30-13:15, ×©× ×™, ×¨×‘×™×¢×™ 08:30-13:15 + 16:00-19:00. **××•×§×“ ×˜×œ×¤×•× ×™:** ××©××¨×•×ª: 07:00-15:00, 13:00-21:00, 15:00-23:00. **×¢×‘×•×“×” ×‘×©×™×©×™:** ×¢×¨×‘ ×—×’/×©×™×©×™ ×¨×’×™×œ ×¢×“ 13:00. **×’××™×©×•×ª:** ××¤×©×¨×•×ª ×”×ª×—×œ×” 07:30-09:00 ×‘×ª×™××•× ×¢× ×”×× ×”×œ.",
    sources: ["× ×•×”×œ HR-101.05", "×”×¡×›× ×§×™×‘×•×¦×™ 2023", "×—×•×–×¨ ×”× ×”×œ×” 15/2024"],
    lastUpdated: "2024-09-30",
    accessLevel: "basic"
  },
  {
    id: 6,
    category: "××©××‘×™ ×× ×•×©",
    question: "××™×š ××’×™×©×™× ×‘×§×©×” ×œ×—×•×¤×©×” ×©× ×ª×™×ª?",
    answer: "×ª×”×œ×™×š ××™×©×•×¨ ×—×•×¤×©×” ×©× ×ª×™×ª (× ×•×”×œ HR-203.12): **1. ×”×’×©×ª ×‘×§×©×”:** ××™×œ×•×™ ×˜×•×¤×¡ ×“×™×’×™×˜×œ×™ ×‘××¢×¨×›×ª '×¢×•×‘×“ ×‘× ×§' ×¢×“ 14 ×™×•× ××¨××©. **2. ××™×©×•×¨ ×¨××©×•× ×™:** ×× ×”×œ ×™×©×™×¨ ×××©×¨ ×ª×•×š 3 ×™××™ ×¢×¡×§×™×. **3. ××™×©×•×¨ HR:** ××©××‘×™ ×× ×•×© ×‘×•×“×§×™× ×™×ª×¨×ª ×™××™× ×•×××©×¨×™×. **4. ×”×•×“×¢×”:** ×”×•×“×¢×” ××•×˜×•××˜×™×ª × ×©×œ×—×ª 24 ×©×¢×•×ª ×œ×¤× ×™ ×”×—×•×¤×©×”. **×–×›××•×™×•×ª ×©× ×ª×™×•×ª:** ×¢×•×‘×“ ×—×“×©: 12 ×™×•×, 1-5 ×©× ×™×: 18 ×™×•×, 5+ ×©× ×™×: 21 ×™×•×, 10+ ×©× ×™×: 24 ×™×•×. **××’×‘×œ×•×ª:** ××§×¡×™××•× 10 ×™××™× ×¨×¦×•×¤×™× ×œ×œ× ××™×©×•×¨ ××™×•×—×“.",
    sources: ["× ×•×”×œ HR-203.12", "××¢×¨×›×ª ×¢×•×‘×“ ×‘× ×§", "×–×›×•×™×•×ª ×¢×•×‘×“×™× 2024"],
    lastUpdated: "2024-10-01",
    accessLevel: "basic"
  },
  {
    id: 7,
    category: "××©××‘×™ ×× ×•×©",
    question: "××” ×”× ×•×”×œ ×œ×“×™×•×•×— ××—×œ×”?",
    answer: "× ×•×”×œ ×“×™×•×•×— ××—×œ×” ×•××—×œ×ª ×™×œ×“ (HR-204.08): **×“×™×•×•×— ××™×™×“×™:** ×”×•×“×¢×” ×˜×œ×¤×•× ×™×ª ×œ×× ×”×œ ×™×©×™×¨ + ×”×•×“×¢×” ×‘××¢×¨×›×ª ×¢×“ 09:30. **××¡××›×™× × ×“×¨×©×™×:** ××™×©×•×¨ ×¨×•×¤× ×œ×™×•× ××—×“ ×•××¢×œ×”, ××™×©×•×¨ ×¨×•×¤× ×™×œ×“×™× ×œ××—×œ×ª ×™×œ×“. **×–×›××•×™×•×ª:** 18 ×™××™ ××—×œ×” ×œ×©× ×” (××¦×˜×‘×¨×™× ×¢×“ 90 ×™×•×), 8 ×™××™ ××—×œ×ª ×™×œ×“ ×œ×©× ×”. **×”×—×–×¨:** 100% ××”×©×›×¨ ×œ×™××™× 1-90, 75% ×œ×™××™× 91-180. **×‘×™×§×•×¨×ª ×¨×¤×•××™×ª:** ××¢×œ 3 ×™××™× ×¨×¦×•×¤×™× - ×‘×“×™×§×ª ×¨×•×¤× ×‘× ×§. **×—×–×¨×” ×œ×¢×‘×•×“×”:** ××™×©×•×¨ ×›×•×©×¨ ×¢×‘×•×“×” ××¨×•×¤× ××˜×¤×œ ×œ××—×¨ ××—×œ×” ××¢×œ 7 ×™××™×.",
    sources: ["× ×•×”×œ HR-204.08", "×‘×™×˜×•×— ×œ××•××™ - ×”×•×¨××•×ª", "×¨×•×¤× ×”×‘× ×§"],
    lastUpdated: "2024-09-25",
    accessLevel: "basic"
  },
  {
    id: 8,
    category: "××©××‘×™ ×× ×•×©",
    question: "××™×š ××‘×§×©×™× ×©×¢×•×ª × ×•×¡×¤×•×ª?",
    answer: "× ×•×”×œ ×©×¢×•×ª × ×•×¡×¤×•×ª ×•×ª×’××•×œ×™× (HR-105.20): **××™×©×•×¨ ××•×§×“×:** ×—×•×‘×” ×œ×§×‘×œ ××™×©×•×¨ ×× ×”×œ ×™×©×™×¨ ×œ×¤× ×™ ×‘×™×¦×•×¢. **×”×’×©×”:** ×“×™×•×•×— ×‘××¢×¨×›×ª '×¦×™×•×Ÿ ×©×¢×•×ª' ×ª×•×š 3 ×™××™ ×¢×¡×§×™×. **×–×›××•×™×•×ª ×œ×¤×™ ×“×¨×’×”:** ×“×¨×’×•×ª 1-6: ×ª×©×œ×•× 125% ×¢×“ 150% ×œ×¤×™ ×™×•× ×”×©×‘×•×¢. ×“×¨×’×•×ª 7+: ×¤×˜×•×¨ ××©×¢×•×ª × ×•×¡×¤×•×ª, ×–×›××™× ×œ×”×¤×’×”. **××’×‘×œ×•×ª:** ×¢×“ 20 ×©×¢×•×ª ×—×•×“×©×™×•×ª ×œ×œ× ××™×©×•×¨ ××™×•×—×“, 40 ×©×¢×•×ª ×¢× ××™×©×•×¨ ×× ×›\"×œ. **×ª×©×œ×•×:** ×ª×•×¡×¤×ª ×œ×©×›×¨ ×”×—×•×“×© ×”×‘×. **×—×™×¨×•×:** ×‘××¦×‘×™ ×—×™×¨×•× - ××™×©×•×¨ ×œ××¤×¨×¢ ×ª×•×š 24 ×©×¢×•×ª.",
    sources: ["× ×•×”×œ HR-105.20", "×”×¡×›× ×§×™×‘×•×¦×™ ×¡×¢×™×£ 12", "××¢×¨×›×ª ×¦×™×•×Ÿ ×©×¢×•×ª"],
    lastUpdated: "2024-10-05",
    accessLevel: "basic"
  },
  {
    id: 9,
    category: "××©××‘×™ ×× ×•×©",
    question: "××” ×–×›×•×™×•×ª ×”×—×•×¤×©×ª ×œ×™×“×” ×•×”×•×¨×•×ª?",
    answer: "×–×›×•×™×•×ª ×”×•×¨×•×ª ×•×œ×™×“×” (HR-210.15): **×—×•×¤×©×ª ×œ×™×“×”:** 15 ×©×‘×•×¢×•×ª ×œ×× (3 ×œ×¤× ×™ + 12 ××—×¨×™), 7 ×™××™× ×œ××‘. **×—×•×¤×©×ª ×”×•×¨×•×ª:** ×¢×“ 12 ×—×•×“×©×™× × ×•×¡×¤×™× ×œ×œ× ×ª×©×œ×•× (×œ×—×œ×§ ×‘×™×Ÿ ×”×”×•×¨×™×). **×”×•×“×¢×” ××•×§×“××ª:** 30 ×™×•× ×œ×¤× ×™ ×”×ª×—×œ×ª ×—×•×¤×©×”. **×©×›×¨:** 100% ×©×›×¨ ×œ×ª×§×•×¤×” ×”××œ××” ××‘×™×˜×•×— ×œ××•××™ + ×”×©×œ××” ××”×‘× ×§. **×©××™×¨×ª ××§×•× ×¢×‘×•×“×”:** ××•×‘×˜×—×ª ×œ×¢×“ 12 ×—×•×“×©×™×. **×–×›×•×™×•×ª × ×•×¡×¤×•×ª:** ×™××™ ××—×œ×ª ×™×œ×“ × ×•×¡×¤×™×, ×”× ×§×” ×‘××§×•× ×”×¢×‘×•×“×”, ×’××™×©×•×ª ×©×¢×•×ª. **×—×–×¨×” ×”×“×¨×’×ª×™×ª:** ××¤×©×¨×•×ª ×œ×—×–×¨×” ×”×“×¨×’×ª×™×ª ×‘××©×¨×” ×—×œ×§×™×ª.",
    sources: ["× ×•×”×œ HR-210.15", "×—×•×§ ×”×’× ×ª ×”×©×›×¨", "×–×›×•×™×•×ª ×”×•×¨×™× 2024"],
    lastUpdated: "2024-09-20",
    accessLevel: "basic"
  },
  {
    id: 10,
    category: "××©××‘×™ ×× ×•×©",
    question: "××™×š ××’×™×©×™× ×ª×œ×•× ×” ××• ×¤× ×™×™×” ×œ××©××‘×™ ×× ×•×©?",
    answer: "× ×•×”×œ ×˜×™×¤×•×œ ×‘×¤× ×™×•×ª ×¢×•×‘×“×™× (HR-301.10): **×“×¨×›×™ ×¤× ×™×™×”:** 1. ×¤× ×™×™×” ×™×©×™×¨×” ×œ×× ×”×œ ×™×©×™×¨, 2. ××¢×¨×›×ª '×©×™×¨×•×ª ×¢×•×‘×“×™×' ×‘××™× ×˜×¨×-× ×˜, 3. ×˜×œ×¤×•×Ÿ ×—× HR: 02-6552800, 4. ×¤×’×™×©×” ××™×©×™×ª ×‘×ª×™××•×. **×¡×•×’×™ ×¤× ×™×•×ª:** ×‘×¢×™×•×ª ××©××¢×ª, ×”×˜×¨×“×•×ª, ×‘×¢×™×•×ª ×©×›×¨, ×§×™×“×•×, ×ª× ××™ ×¢×‘×•×“×”, ×¤×’×™×¢×” ×‘×›×‘×•×“. **×–×× ×™ ×˜×™×¤×•×œ:** ×¤× ×™×•×ª ×¨×’×™×œ×•×ª - 5 ×™××™ ×¢×¡×§×™×, ×“×—×•×¤×•×ª - 24 ×©×¢×•×ª, ×”×˜×¨×“×•×ª - ×˜×™×¤×•×œ ××™×™×“×™. **×¡×•×“×™×•×ª ××•×‘×˜×—×ª:** ×›×œ ×”×¤× ×™×•×ª ××˜×•×¤×œ×•×ª ×‘×“×™×¡×§×¨×˜×™×•×ª ××œ××”. **×–×›×•×ª ×¢×¨×¢×•×¨:** ××¤×©×¨×•×ª ×¢×¨×¢×•×¨ ×œ×•×•×¢×“×ª ××©××¢×ª ××• ×× ×›\"×œ.",
    sources: ["× ×•×”×œ HR-301.10", "×˜×œ×¤×•×Ÿ ×—× HR", "×•×¢×“×ª ××©××¢×ª"],
    lastUpdated: "2024-10-03",
    accessLevel: "basic"
  },
  {
    id: 11,
    category: "×× ×”×œ×™×",
    question: "××” ×”× ×•×”×œ ×œ××™×©×•×¨ ×—×•×¤×©×” ×œ×¢×•×‘×“×™×?",
    answer: "× ×•×”×œ ×× ×”×œ×™× - ××™×©×•×¨ ×—×•×¤×©×•×ª (MNG-105.30): **×¢×§×¨×•× ×•×ª ××™×©×•×¨:** 1. ×©××™×¨×” ×¢×œ ×¨×¦×™×¤×•×ª ×©×™×¨×•×ª, 2. ×—×œ×•×§×” ×”×•×’× ×ª ×œ×›×œ ×”×¢×•×‘×“×™×, 3. ×¢×“×™×¤×•×ª ×œ×•×•×ª×™×§×™× ×‘×ª××¨×™×›×™ ×©×™×. **×‘×“×™×§×•×ª × ×“×¨×©×•×ª:** ×™×ª×¨×ª ×™××™× ×‘××¢×¨×›×ª, ×›×™×¡×•×™ ×ª×¤×§×™×“, ×¢×•××¡ ×¢×‘×•×“×” ×¦×¤×•×™. **××’×‘×œ×•×ª:** ×œ× ×™×•×ª×¨ ×-30% ××”×¦×•×•×ª ×‘×—×•×¤×©×” ×™×—×“, ××§×¡×™××•× 10 ×™××™× ×¨×¦×•×¤×™×. **×¢×“×™×¤×•×™×•×ª:** ×—×’×™× - ×œ×¤×™ ×•×ª×§, ×§×™×¥ - ×¡×‘×‘×™× ×©× ×ª×™×™×, ××§×¨×™ ×—×™×¨×•× - ×¢× ×™×™× ×™ ××©×¤×—×”. **×“×—×™×™×ª ×‘×§×©×”:** × ×“×¨×©×ª ×”× ××§×” ×‘×›×ª×‘ + ×”×¦×¢×ª ×ª××¨×™×š ×—×œ×•×¤×™. **×ª×™×¢×•×“:** ×¨×™×©×•× ××™×©×•×¨×™× ×‘×¨×‘×¢×•×Ÿ + ×“×•×— ×©× ×ª×™ ×œ××©××‘×™ ×× ×•×©.",
    sources: ["× ×•×”×œ MNG-105.30", "××¢×¨×›×ª × ×™×”×•×œ ×›×•×— ××“×", "×“×•×— ×—×•×¤×©×•×ª ×¨×‘×¢×•× ×™"],
    lastUpdated: "2024-09-28",
    accessLevel: "branch"
  },
  {
    id: 12,
    category: "IT ×•××‘×˜×—×”",
    question: "××” ×”× ×•×”×œ ×œ×¢×‘×•×“×” ××¨×—×•×§ (Work From Home)?",
    answer: "× ×•×”×œ ×¢×‘×•×“×” ××¨×—×•×§ (IT-SEC-401.25): **×–×›××•×ª:** ×¢×•×‘×“×™× ×‘×“×¨×’×” 4+ ×¢× ×•×ª×§ ××¢×œ ×©× ×”. **×ª×“×™×¨×•×ª:** ×¢×“ 2 ×™××™× ×‘×©×‘×•Ø¹ ×œ××—×¨ ××™×©×•×¨ ×× ×”×œ. **××™×©×•×¨×™× × ×“×¨×©×™×:** ×”×¡×›××” ×“×™×’×™×˜×œ×™×ª, ×”×›×©×¨×ª ××‘×˜×—×”, ×‘×“×™×§×ª ×ª×©×ª×™×•×ª ×‘×™×ª. **×¦×™×•×“ ×××•×©×¨:** ××—×©×‘ × ×™×™×“ ×‘× ×§ + VPN ×—×•×‘×”, ××™×¡×•×¨ ×¢×œ ××—×©×‘×™× ××™×©×™×™×. **×©×¢×•×ª ×¢×‘×•×“×”:** ×–×”×•×ª ×œ××©×¨×“, ×–××™× ×•×ª ×œ×¤×’×™×©×•×ª ×•×©×™×—×•×ª. **××‘×˜×—×ª ××™×“×¢:** ××™×¡×•×¨ ×”×“×¤×¡×”, ××™×¡×•×¨ ×¦×™×œ×•× ××¡×š, × ×¢×™×œ×” ××•×˜×•××˜×™×ª ××—×¨×™ 10 ×“×§'. **×‘×™×§×•×¨×ª:** ××¢×§×‘ ×’×™×©×•×ª ×œ××¢×¨×›×•×ª + ×¤×’×™×©×ª ×¡×˜×˜×•×¡ ×©×‘×•×¢×™×ª. **×‘×™×˜×•×œ ×”×¨×©××”:** ×‘××§×¨×” ×©×œ ×”×¤×¨×ª × ×•×”×œ ××• ×™×¨×™×“×” ×‘×‘×™×¦×•×¢×™×.",
    sources: ["× ×•×”×œ IT-SEC-401.25", "××“×™× ×™×•×ª ××‘×˜×—×ª ××™×“×¢", "×”×¡×›× ×¢×‘×•×“×” ××¨×—×•×§"],
    lastUpdated: "2024-10-12",
    accessLevel: "tech"
  },
  {
    id: 13,
    category: "××©××‘×™ ×× ×•×© - ××¢×¨×›×•×ª",
    question: "××™×š ×× ×•×”×œ ×§×•×‘×¥ ×”××©××¨×•×ª ×‘××¢×¨×›×ª HR?",
    answer: "××¢×¨×›×ª × ×™×”×•×œ ××©××¨×•×ª (HR-SYS-401.15): **× ×ª×•× ×™ ×¢×•×‘×“ ×‘×§×•×‘×¥:** ×ª\"×–, ×©× ××œ×, ××—×œ×§×”, ×ª×¤×§×™×“. **×¤×¨×˜×™ ××©××¨×ª:** ×ª××¨×™×š, ×™×•× ×‘×©×‘×•×¢, ×©×¢×ª ×”×ª×—×œ×” ×•×¡×™×•×, ×¡×•×’ ××©××¨×ª (×‘×•×§×¨ 07:00-15:00 / ×¢×¨×‘ 15:00-23:00 / ×œ×™×œ×” 23:00-07:00). **×—×™×©×•×‘ ×©×¢×•×ª:** ×”××¢×¨×›×ª ××—×©×‘×ª ××•×˜×•××˜×™×ª ×¡×”\"×› ×©×¢×•×ª ×‘×¤×•×¢×œ ×›×•×œ×œ ×”×¤×¡×§×•×ª. **×¢×“×›×•×Ÿ × ×ª×•× ×™×:** ×”××©××¨×•×ª ××¢×•×“×›× ×•×ª ×™×•××™×ª ×‘××¢×¨×›×ª '×–×× ×™× ×•× ×•×›×—×•×ª'. **×“×•×—×•×ª:** ×“×•×— ×—×•×“×©×™ ×œ×›×œ ×¢×•×‘×“ + ×“×•×— ××—×œ×§×ª×™ ×œ×× ×”×œ×™×. **×’×™×©×”:** ×¢×•×‘×“×™× ×¨×•××™× ××©××¨×•×ª ×¢×¦××™×•×ª, ×× ×”×œ×™× ×¨×•××™× ×¦×•×•×ª, HR ×¨×•××” ×”×›×œ.",
    sources: ["× ×•×”×œ HR-SYS-401.15", "××¢×¨×›×ª ×–×× ×™× ×•× ×•×›×—×•×ª", "××“×¨×™×š ××©×ª××© ××©××¨×•×ª"],
    lastUpdated: "2024-10-15",
    accessLevel: "basic"
  },
  {
    id: 14,
    category: "××©××‘×™ ×× ×•×© - ×–×›×•×™×•×ª",
    question: "××™×š ×¢×•×‘×“ ××¢×¨×›×ª ×”×–×›××•×™×•×ª ×•× ×™×¦×•×œ (×—×•×¤×©×”, ×”×‘×¨××”, ×‘×™×’×•×“, ××ª× ×•×ª)?",
    answer: "××¢×¨×›×ª ×–×›××•×™×•×ª ×•× ×™×¦×•×œ (HR-ENT-205.40): **×¡×•×’×™ ×–×›××•×™×•×ª:** ×—×•×¤×©×” ×©× ×ª×™×ª (18-24 ×™××™×), ×”×‘×¨××” (7 ×™××™×), ×‘×™×’×•×“ (1,500â‚ª ×©× ×ª×™), ××ª× ×•×ª ×œ×—×’×™× (500â‚ª). **××¢×§×‘ ×™×ª×¨×•×ª:** ×™×ª×¨×ª ×–×›××•×ª ×©× ×ª×™×ª ××ª×¢×“×›× ×ª ×‘-1 ×‘×™× ×•××¨, × ×™×¦×•×œ ×‘×¤×•×¢×œ ×¢×“ ×›×” ××ª×¢×“×›×Ÿ ×™×•××™. **×™×ª×¨×” × ×•×›×—×™×ª:** ×–×›××•×ª ××™× ×•×¡ × ×™×¦×•×œ = ×™×ª×¨×” ×–××™× ×”. **×”×ª×¨××•×ª ××¢×¨×›×ª:** ×”×•×“×¢×” ×‘-90% × ×™×¦×•×œ, ×ª×–×›×•×¨×ª ×œ×¤× ×™ ×¤×§×™×¢×”. **×”×¢×‘×¨×ª ×™×ª×¨×•×ª:** ×—×•×¤×©×” - ×¢×“ 5 ×™××™× ×œ×©× ×” ×”×‘××”, ×”×‘×¨××” - ×œ× ××•×¢×‘×¨×ª. **××™×©×•×¨×™×:** ×—×•×¤×©×” ×œ××¢×œ×” ×-5 ×™××™× ×“×•×¨×©×ª ××™×©×•×¨ ×× ×”×œ + HR.",
    sources: ["× ×•×”×œ HR-ENT-205.40", "××¢×¨×›×ª ×–×›××•×™×•×ª", "×ª×§× ×•×Ÿ ×”×¢×‘×¨×ª ×™×ª×¨×•×ª"],
    lastUpdated: "2024-10-10",
    accessLevel: "basic"
  },
  {
    id: 15,
    category: "××©××‘×™ ×× ×•×© - ××—×œ×”",
    question: "××™×š ×× ×•×”×œ ××¢×§×‘ ×™××™ ××—×œ×” ××•×œ ×–×›××•×ª?",
    answer: "××¢×¨×›×ª ×™××™ ××—×œ×” (HR-SICK-302.18): **×–×›××•×ª ×©× ×ª×™×ª:** 18 ×™××™ ××—×œ×” ×‘×©× ×ª ×›×¡×¤×™× + 8 ×™××™ ××—×œ×ª ×™×œ×“. **×–×›××•×ª ×›×œ×œ×™×ª ××¦×˜×‘×¨×ª:** ×¢×“ 90 ×™××™ ××—×œ×” ××§×¡×™××•× (××¦×˜×‘×¨ ××©× ×™× ×§×•×“××•×ª). **××¢×§×‘ × ×™×¦×•×œ:** ×›×œ ×™×•× ××—×œ×” × ×¨×©× ×¢× ×ª××¨×™×š, ×¡×•×’ (××—×œ×” ×¢×¦××™×ª/×™×œ×“), ××™×©×•×¨ ×¨×•×¤×. **×™×ª×¨×” × ×•×›×—×™×ª:** ×”××¢×¨×›×ª ××—×©×‘×ª: ×–×›××•×ª ×›×œ×œ×™×ª - × ×™×¦×•×œ ×”×©× ×” - ×™×ª×¨×•×ª ×©× ×™× ×§×•×“××•×ª. **×”×ª×¨××•×ª:** ×”×•×“×¢×” ×‘-15 ×™××™×, ××–×”×¨×” ×‘-17 ×™××™×, ×—×¡×™××” ×‘-18+ ×™××™×. **××™×©×•×¨×™× ×¨×¤×•××™×™×:** ×—×•×‘×” ××”×™×•× ×”×¨××©×•×Ÿ, ×‘×“×™×§×ª ×¨×•×¤× ×‘× ×§ ××¢×œ 7 ×™××™× ×¨×¦×•×¤×™×.",
    sources: ["× ×•×”×œ HR-SICK-302.18", "××¢×¨×›×ª ××—×œ×•×ª", "×‘×™×˜×•×— ×œ××•××™ - ×”× ×—×™×•×ª"],
    lastUpdated: "2024-10-08",
    accessLevel: "basic"
  },
  {
    id: 16,
    category: "××©××‘×™ ×× ×•×© - ×˜×•×¤×¡ 101",
    question: "××” ×–×” ×˜×•×¤×¡ 101 ×•××™×š ×× ×•×”×œ×™× × ×ª×•× ×™ ××©×¤×—×”?",
    answer: "×˜×•×¤×¡ 101 - × ×ª×•× ×™ ××©×¤×—×” (HR-FAM-150.25): **××˜×¨×”:** ×¢×“×›×•×Ÿ ×©× ×ª×™ ×©×œ × ×ª×•× ×™ ××©×¤×—×” ×œ×¦×¨×›×™ ×–×›×•×™×•×ª ×•×‘×™×˜×•×—×™×. **× ×ª×•× ×™× ×”× ×“×¨×©×™×:** ×ª\"×– ×¢×•×‘×“, ××¡×¤×¨ ×™×œ×“×™×, ×’×™×œ××™ ×”×™×œ×“×™× (×¢×“ 18), ×¡×˜×˜×•×¡ ××©×¤×—×ª×™ (×¨×•×•×§/× ×©×•×™/×’×¨×•×©/××œ××Ÿ). **×¢×“×›×•×Ÿ ×©× ×ª×™:** ×—×•×‘×ª ×¢×“×›×•×Ÿ ×¢×“ 31 ×‘×™× ×•××¨ ×›×œ ×©× ×”. **×”×©×¤×¢×” ×¢×œ ×–×›×•×™×•×ª:** ××¡×¤×¨ ×™×œ×“×™× ××©×¤×™×¢ ×¢×œ: ××ª× ×•×ª, ×™××™ ××—×œ×ª ×™×œ×“, ×§×¦×‘×ª ×™×œ×“×™×, ×‘×™×˜×•×— ×‘×¨×™××•×ª ××©×œ×™×. **××¡××›×™× × ×“×¨×©×™×:** ×ª×¢×•×“×•×ª ×œ×™×“×”, ××™×©×•×¨ ××©×¤×—×ª×™ ×¢×“×›× ×™ ××¨×©× ×”××•×›×œ×•×¡×™×Ÿ. **×¢×“×›×•× ×™× ×—×¨×™×’×™×:** ×œ×™×“×”, ××™××•×¥, ×’×™×¨×•×©×™×Ÿ - ×¢×“×›×•×Ÿ ×ª×•×š 30 ×™×•× ××”××™×¨×•×¢.",
    sources: ["×˜×•×¤×¡ 101 - ×”×•×¨××•×ª", "××¢×¨×›×ª × ×ª×•× ×™ ××©×¤×—×”", "×–×›×•×™×•×ª ×œ×¤×™ ××¦×‘ ××©×¤×—×ª×™"],
    lastUpdated: "2024-09-30",
    accessLevel: "basic"
  },
  {
    id: 17,
    category: "××©××‘×™ ×× ×•×© - ×—×•×¤×©×•×ª",
    question: "××™×š ×× ×•×”×œ × ×™×¦×•×œ ×—×•×¤×©×” ×¨×¦×™×¤×”?",
    answer: "× ×™×¦×•×œ ×—×•×¤×©×” ×¨×¦×™×¤×” (HR-VAC-280.33): **×”×’×“×¨×ª ×—×•×¤×©×” ×¨×¦×™×¤×”:** 5+ ×™××™ ×—×•×¤×©×” ×¨×¦×•×¤×™× (×œ× ×›×•×œ×œ ×¡×•×¤×™ ×©×‘×•×¢ ×•×—×’×™×). **×¨×™×©×•× ×‘××¢×¨×›×ª:** ×ª××¨×™×š ×ª×—×™×œ×” ×•×¡×™×•×, ××¡×¤×¨ ×™××™ ×¢×‘×•×“×” ×‘×¤×•×¢×œ, ×¡×•×’ ×—×•×¤×©×” (×©× ×ª×™×ª/××™×•×—×“×ª/×œ×œ× ×ª×©×œ×•×). **××™×©×•×¨×™× × ×“×¨×©×™×:** 5-10 ×™××™× - ×× ×”×œ ×™×©×™×¨, 10+ ×™××™× - ×× ×”×œ + HR, ×—×•×¤×©×” ×œ×œ× ×ª×©×œ×•× - ×× ×›\"×œ. **××’×‘×œ×•×ª ×©× ×ª×™×•×ª:** ×¢×“ 15 ×™××™× ×¨×¦×•×¤×™× ×‘××§×˜×¢ ××—×“, ××§×¡×™××•× 2 ×—×•×¤×©×•×ª ××¨×•×›×•×ª ×‘×©× ×”. **×ª×›× ×•×Ÿ ××¨××©:** ×”×’×©×ª ×‘×§×©×” 30 ×™×•× ××¨××© ×œ×—×•×¤×©×•×ª ××¢×œ 7 ×™××™×. **×¢×“×™×¤×•×ª ×‘×—×•×¤×©×•×ª:** ×¢×•×‘×“×™× ×¢× ×™×œ×“×™× ×‘×—×•×¤×©×ª ×§×™×¥, ×•×ª×™×§×™× ×‘×—×’×™ ×ª×©×¨×™.",
    sources: ["× ×•×”×œ HR-VAC-280.33", "××¢×¨×›×ª ×—×•×¤×©×•×ª", "×œ×•×— ×¢×“×™×¤×•×™×•×ª ×—×•×¤×©×•×ª"],
    lastUpdated: "2024-10-12",
    accessLevel: "basic"
  },
  {
    id: 18,
    category: "××©××‘×™ ×× ×•×© - ××ª× ×•×ª ×™×œ×“×™×",
    question: "××” ×–×›××•×ª ×”××ª× ×•×ª ×œ×™×œ×“×™× ×•×›×™×¦×“ ×× ×•×”×œ×ª?",
    answer: "×–×›××•×ª ××ª× ×•×ª ×œ×™×œ×“×™× (HR-GIFT-345.60): **×–×›××•×ª ×œ×¤×™ ×’×™×œ:** ×’×™×œ 0-12: ××ª× ×” + 200â‚ª, ×’×™×œ 13-18: 300â‚ª ×‘××–×•××Ÿ, ××¢×œ 18: ×œ× ×–×›××™. **×ª× ××™ ×–×›××•×ª:** ×™×œ×“ ×¨×©×•× ×‘×˜×•×¤×¡ 101, ×¢×•×‘×“ ×‘××©×¨×” ××¢×œ 50%, ×•×ª×§ ××™× ×™××œ×™ 6 ×—×•×“×©×™×. **××•×¢×“×™ ×—×œ×•×§×”:** ×¨××© ×”×©× ×” (×¡×¤×˜××‘×¨), ×—× ×•×›×” (×“×¦××‘×¨), ×¤×¡×— (××¨×¥-××¤×¨×™×œ). **×¡×˜×˜×•×¡ ××™××•×©:** '×××ª×™×Ÿ' - ×˜×¨× ×”×•×’×©, '×‘×˜×™×¤×•×œ' - HR ×‘×•×“×§ ×–×›××•×ª, '××•×©×¨' - ××ª× ×”/×›×¡×£ ×”×•×¢×‘×¨×•. **×”×’×©×ª ×‘×§×©×”:** ×“×¨×š ××¢×¨×›×ª HR ×¢×“ 30 ×œ×—×•×“×© ×©×œ×¤× ×™ ×”×—×’. **××™×©×•×¨ ××•×˜×•××˜×™:** ×¢×•×‘×“×™× ×§×‘×•×¢×™× ×¢× × ×ª×•× ×™× ××¢×•×“×›× ×™× ×‘×˜×•×¤×¡ 101.",
    sources: ["× ×•×”×œ HR-GIFT-345.60", "××¢×¨×›×ª ××ª× ×•×ª", "×˜×‘×œ×ª ×–×›××•×™×•×ª ×œ×¤×™ ×’×™×œ"],
    lastUpdated: "2024-10-05",
    accessLevel: "basic"
  },
  {
    id: 19,
    category: "××©××‘×™ ×× ×•×© - ×©×¢×•×ª × ×•×¡×¤×•×ª",
    question: "××™×š ××—×•×©×‘×ª ×”×–×›××•×ª ×”×—×•×“×©×™×ª ×œ×©×¢×•×ª × ×•×¡×¤×•×ª?",
    answer: "×–×›××•×ª ×—×•×“×©×™×ª ×©×¢×•×ª × ×•×¡×¤×•×ª (HR-OT-420.75): **×‘×¡×™×¡ ×—×™×©×•×‘:** 160 ×©×¢×•×ª ×—×•×“×©×™×•×ª ×¡×˜× ×“×¨×˜×™×•×ª (××©×¨×” ××œ××”). **×ª×¢×¨×™×¤×™ ×©×¢×•×ª × ×•×¡×¤×•×ª:** ×¨×’×™×œ: 125%, ×¢×¨×‘ (××—×¨×™ 18:00): 150%, ×©×™×©×™-×©×‘×ª: 200%, ×—×’: 300%. **××’×‘×œ×•×ª ×—×•×“×©×™×•×ª:** ×“×¨×’×•×ª 1-5: ×¢×“ 25 ×©×¢×•×ª × ×•×¡×¤×•×ª, ×“×¨×’×•×ª 6+: ×¢×“ 15 ×©×¢×•×ª × ×•×¡×¤×•×ª. **×—×™×©×•×‘ ×–×›××•×ª:** (×©×¢×•×ª ×‘×¤×•×¢×œ - 160) Ã— ×ª×¢×¨×™×£ Ã— ×©×›×¨ ×©×¢×ª×™ ×‘×¡×™×¡. **××™×©×•×¨ ×× ×”×œ:** ×—×•×‘×” ×œ×§×‘×œ ××™×©×•×¨ ××¨××©, ××™×©×•×¨ ×œ××¤×¨×¢ ×¨×§ ×‘××¦×‘×™ ×—×™×¨×•×. **×ª×©×œ×•×:** ××ª×•×•×¡×£ ×œ×©×›×¨ ×”×—×•×“×© ×”×‘×, ×¢× ×¤×™×¨×•×˜ ×‘×ª×œ×•×© ×”×©×›×¨. **××¢×§×‘:** ×“×•×— ×—×•×“×©×™ ×œ×›×œ ×¢×•×‘×“ + ×”×ª×¨××” ×‘×”×’×¢×” ×œ-80% ××”××›×¡×”.",
    sources: ["× ×•×”×œ HR-OT-420.75", "××¢×¨×›×ª ×©×¢×•×ª × ×•×¡×¤×•×ª", "×ª×¢×¨×™×¤×•×Ÿ ×ª×’××•×œ×™× 2024"],
    lastUpdated: "2024-10-15",
    accessLevel: "basic"
  }
];

// User profiles simulation with employment status
// ××¡×“ × ×ª×•× ×™× ××§×™×£ ×©×œ ×¢×•×‘×“×™× ×¢× ×›×œ ×”× ×ª×•× ×™× ×”××™×©×™×™×
const employeeDatabase = {
  "call_center": {
    // ×¤×¨×˜×™× ××™×©×™×™×
    id: "123456789",
    name: "×¨×—×œ ×›×”×Ÿ",
    role: "× ×¦×™×’×ª ××•×§×“ ×˜×œ×¤×•× ×™",
    department: "×©×™×¨×•×ª ×œ×§×•×—×•×ª",
    accessLevel: "basic",
    avatar: "×¨.×›",
    permissions: ["basic", "customer_service"],
    employmentType: "hourly", // ×©×¢×ª×™
    seniority: 8, // ×—×•×“×©×™×
    grade: 3,
    hireDate: "2024-02-01",
    
    // × ×ª×•× ×™ ××©×¤×—×” (×˜×•×¤×¡ 101)
    familyData: {
      maritalStatus: "× ×©×•××”",
      numberOfChildren: 2,
      childrenAges: [5, 8],
      spouseDetails: { name: "×™×•×¡×™ ×›×”×Ÿ", birthYear: 1988 },
      lastUpdated: "2024-01-15"
    },
    
    // ×–×›××•×™×•×ª ×©× ×ª×™×•×ª ×œ×¤×™ ×•×ª×§ ×•×¡×•×’ ×”×¢×¡×§×”
    annualEntitlements: {
      vacation: 12, // ×™××™ ×—×•×¤×©×” - ×¢×•×‘×“ ×—×“×©
      recovery: 0,  // ××™×Ÿ ×–×›××•×ª ×œ×”×‘×¨××” ×œ×©×¢×ª×™
      clothing: 800, // ×‘×™×’×•×“ ××•×¤×—×ª ×œ×©×¢×ª×™
      gifts: 300,   // ××ª× ×•×ª ×œ×—×’×™× ××•×¤×—×ª×•×ª
      sickDays: 12, // ×™××™ ××—×œ×” ××•×¤×—×ª×™× ×œ×©×¢×ª×™
      childSickDays: 6 // ×™××™ ××—×œ×ª ×™×œ×“ ××•×¤×—×ª×™×
    },
    
    // × ×™×¦×•×œ ×”×©× ×” 2024
    currentYearUsage: {
      vacation: {
        used: 3,
        dates: [
          { startDate: "2024-03-15", endDate: "2024-03-17", days: 3, type: "×—×•×¤×©×” ×©× ×ª×™×ª" }
        ]
      },
      recovery: { used: 0, dates: [] },
      sickDays: {
        used: 2,
        dates: [
          { date: "2024-04-10", type: "××—×œ×” ×¢×¦××™×ª" },
          { date: "2024-05-22", type: "××—×œ×” ×¢×¦××™×ª" }
        ]
      },
      childSickDays: {
        used: 1,
        dates: [
          { date: "2024-06-03", childAge: 5, type: "××—×œ×ª ×™×œ×“" }
        ]
      }
    },
    
    // ×™×ª×¨×•×ª ×¦×‘×•×¨×•×ª ××©× ×™× ×§×•×“××•×ª
    accumulatedBalance: {
      sickDays: 8, // ×™××™ ××—×œ×” ××¦×˜×‘×¨×™×
      vacation: 0  // ×—×•×¤×©×” ×œ× ××•×¢×‘×¨×ª ×œ×©×¢×ª×™
    },
    
    // ×–×›××•×ª ××ª× ×•×ª ×œ×™×œ×“×™×
    childrenGifts: {
      eligibleChildren: 2,
      giftStatus2024: {
        "×¨××© ×”×©× ×”": "× ××¡×¨",
        "×—× ×•×›×”": "×××ª×™×Ÿ",
        "×¤×¡×—": "×œ× ×¨×œ×•×•× ×˜×™ ×¢×“×™×™×Ÿ"
      }
    },
    
    // × ×ª×•× ×™ ××©××¨×•×ª ×•×©×¢×•×ª × ×•×¡×¤×•×ª
    workData: {
      monthlyHours: 140, // ×©×¢×•×ª ×—×•×“×©×™×•×ª ×××•×¦×¢×•×ª (××©×¨×” ×—×œ×§×™×ª)
      overtimeThisMonth: 8,
      overtimeDetails: [
        { date: "2024-10-02", hours: 2, rate: "125%", approved: true },
        { date: "2024-10-08", hours: 3, rate: "150%", approved: true },
        { date: "2024-10-15", hours: 3, rate: "125%", approved: true }
      ]
    }
  },
  
  "call_center_permanent": {
    // ×¤×¨×˜×™× ××™×©×™×™×  
    id: "987654321",
    name: "××™×›×œ ××‘×¨×”×",
    role: "× ×¦×™×’×ª ××•×§×“ ×‘×›×™×¨×”",
    department: "×©×™×¨×•×ª ×œ×§×•×—×•×ª",
    accessLevel: "basic",
    avatar: "×.×",
    permissions: ["basic", "customer_service", "senior"],
    employmentType: "permanent", // ×§×‘×•×¢
    seniority: 36, // ×—×•×“×©×™×
    grade: 5,
    hireDate: "2021-10-01",
    
    // × ×ª×•× ×™ ××©×¤×—×” (×˜×•×¤×¡ 101)
    familyData: {
      maritalStatus: "×’×¨×•×©×”",
      numberOfChildren: 1,
      childrenAges: [12],
      spouseDetails: null,
      lastUpdated: "2024-01-20"
    },
    
    // ×–×›××•×™×•×ª ×©× ×ª×™×•×ª ×œ×¤×™ ×•×ª×§ ×•×¡×•×’ ×”×¢×¡×§×”
    annualEntitlements: {
      vacation: 18, // ×™××™ ×—×•×¤×©×” - 1-5 ×©× ×™×
      recovery: 7,  // ×–×›××•×ª ×œ×”×‘×¨××” ××œ××”
      clothing: 1500, // ×‘×™×’×•×“ ××œ×
      gifts: 500,   // ××ª× ×•×ª ×œ×—×’×™× ××œ××•×ª
      sickDays: 18, // ×™××™ ××—×œ×” ××œ××™×
      childSickDays: 8 // ×™××™ ××—×œ×ª ×™×œ×“ ××œ××™×
    },
    
    // × ×™×¦×•×œ ×”×©× ×” 2024
    currentYearUsage: {
      vacation: {
        used: 12,
        dates: [
          { startDate: "2024-01-08", endDate: "2024-01-12", days: 5, type: "×—×•×¤×©×” ×©× ×ª×™×ª" },
          { startDate: "2024-07-15", endDate: "2024-07-21", days: 7, type: "×—×•×¤×©×” ×¨×¦×™×¤×”" }
        ]
      },
      recovery: {
        used: 4,
        dates: [
          { startDate: "2024-09-02", endDate: "2024-09-05", days: 4, type: "×”×‘×¨××”" }
        ]
      },
      sickDays: {
        used: 5,
        dates: [
          { date: "2024-02-14", type: "××—×œ×” ×¢×¦××™×ª" },
          { date: "2024-02-15", type: "××—×œ×” ×¢×¦××™×ª" },
          { date: "2024-06-20", type: "××—×œ×” ×¢×¦××™×ª" },
          { date: "2024-08-12", type: "××—×œ×” ×¢×¦××™×ª" },
          { date: "2024-09-18", type: "××—×œ×” ×¢×¦××™×ª" }
        ]
      },
      childSickDays: {
        used: 3,
        dates: [
          { date: "2024-03-25", childAge: 12, type: "××—×œ×ª ×™×œ×“" },
          { date: "2024-05-10", childAge: 12, type: "××—×œ×ª ×™×œ×“" },
          { date: "2024-09-05", childAge: 12, type: "××—×œ×ª ×™×œ×“" }
        ]
      }
    },
    
    // ×™×ª×¨×•×ª ×¦×‘×•×¨×•×ª ××©× ×™× ×§×•×“××•×ª
    accumulatedBalance: {
      sickDays: 25, // ×™××™ ××—×œ×” ××¦×˜×‘×¨×™×
      vacation: 3   // ×—×•×¤×©×” ××•×¢×‘×¨×ª ××©× ×” ×©×¢×‘×¨×”
    },
    
    // ×–×›××•×ª ××ª× ×•×ª ×œ×™×œ×“×™×
    childrenGifts: {
      eligibleChildren: 1,
      giftStatus2024: {
        "×¨××© ×”×©× ×”": "× ××¡×¨",
        "×—× ×•×›×”": "× ××¡×¨", 
        "×¤×¡×—": "×œ× ×¨×œ×•×•× ×˜×™ ×¢×“×™×™×Ÿ"
      }
    },
    
    // × ×ª×•× ×™ ××©××¨×•×ª ×•×©×¢×•×ª × ×•×¡×¤×•×ª
    workData: {
      monthlyHours: 160, // ×©×¢×•×ª ×—×•×“×©×™×•×ª ××œ××•×ª
      overtimeThisMonth: 15,
      overtimeDetails: [
        { date: "2024-10-01", hours: 4, rate: "125%", approved: true },
        { date: "2024-10-07", hours: 6, rate: "150%", approved: true },
        { date: "2024-10-14", hours: 5, rate: "125%", approved: true }
      ]
    }
  },
  
  "call_center_temp": {
    // ×¤×¨×˜×™× ××™×©×™×™×
    id: "456789123",
    name: "××•×¨ ×™×©×¨××œ×™",
    role: "× ×¦×™×’ ××•×§×“ ×–×× ×™",
    department: "×©×™×¨×•×ª ×œ×§×•×—×•×ª",
    accessLevel: "basic",
    avatar: "×.×™",
    permissions: ["basic", "customer_service"],
    employmentType: "temporary", // ×–×× ×™
    seniority: 3, // ×—×•×“×©×™×
    grade: 1,
    hireDate: "2024-07-01",
    
    // × ×ª×•× ×™ ××©×¤×—×” (×˜×•×¤×¡ 101)
    familyData: {
      maritalStatus: "×¨×•×•×§",
      numberOfChildren: 0,
      childrenAges: [],
      spouseDetails: null,
      lastUpdated: "2024-07-15"
    },
    
    // ×–×›××•×™×•×ª ×©× ×ª×™×•×ª ×œ×¤×™ ×•×ª×§ ×•×¡×•×’ ×”×¢×¡×§×”
    annualEntitlements: {
      vacation: 0, // ××™×Ÿ ×–×›××•×ª ×œ×—×•×¤×©×” ×‘×—×•×“×©×™× ×”×¨××©×•× ×™×
      recovery: 0, // ××™×Ÿ ×–×›××•×ª ×œ×”×‘×¨××”  
      clothing: 0, // ××™×Ÿ ×–×›××•×ª ×œ×‘×™×’×•×“ ×¢×“×™×™×Ÿ
      gifts: 200, // ××ª× ×•×ª ××•×¤×—×ª×•×ª ×œ×–×× ×™
      sickDays: 12, // ×™××™ ××—×œ×” ×‘×¡×™×¡×™×™×
      childSickDays: 0 // ××™×Ÿ ×™×œ×“×™×
    },
    
    // × ×™×¦×•×œ ×”×©× ×” 2024
    currentYearUsage: {
      vacation: { used: 0, dates: [] },
      recovery: { used: 0, dates: [] },
      sickDays: {
        used: 1,
        dates: [
          { date: "2024-09-12", type: "××—×œ×” ×¢×¦××™×ª" }
        ]
      },
      childSickDays: { used: 0, dates: [] }
    },
    
    // ×™×ª×¨×•×ª ×¦×‘×•×¨×•×ª ××©× ×™× ×§×•×“××•×ª
    accumulatedBalance: {
      sickDays: 0, // ×¢×•×‘×“ ×—×“×©
      vacation: 0  // ×¢×•×‘×“ ×—×“×©
    },
    
    // ×–×›××•×ª ××ª× ×•×ª ×œ×™×œ×“×™×
    childrenGifts: {
      eligibleChildren: 0,
      giftStatus2024: {}
    },
    
    // × ×ª×•× ×™ ××©××¨×•×ª ×•×©×¢×•×ª × ×•×¡×¤×•×ª
    workData: {
      monthlyHours: 160, // ×©×¢×•×ª ×—×•×“×©×™×•×ª ××œ××•×ª
      overtimeThisMonth: 3,
      overtimeDetails: [
        { date: "2024-10-09", hours: 3, rate: "125%", approved: true }
      ]
    }
  },
  
  "branch": {
    // ×¤×¨×˜×™× ××™×©×™×™×
    id: "789123456",
    name: "×“×•×“ ×œ×•×™",
    role: "×× ×”×œ ×¡× ×™×£",
    department: "×¡× ×™×£ ×ª×œ ××‘×™×‘",
    accessLevel: "branch",
    avatar: "×“.×œ",
    permissions: ["basic", "branch", "credit"],
    employmentType: "permanent", // ×§×‘×•×¢
    seniority: 84, // ×—×•×“×©×™× (7 ×©× ×™×)
    grade: 8,
    hireDate: "2017-10-01",
    
    // × ×ª×•× ×™ ××©×¤×—×” (×˜×•×¤×¡ 101)
    familyData: {
      maritalStatus: "× ×©×•×™",
      numberOfChildren: 3,
      childrenAges: [15, 17, 20],
      spouseDetails: { name: "×¨×•× ×™×ª ×œ×•×™", birthYear: 1985 },
      lastUpdated: "2024-01-25"
    },
    
    // ×–×›××•×™×•×ª ×©× ×ª×™×•×ª ×œ×¤×™ ×•×ª×§ ×•×¡×•×’ ×”×¢×¡×§×”
    annualEntitlements: {
      vacation: 21, // ×™××™ ×—×•×¤×©×” - 5+ ×©× ×™×
      recovery: 7,  // ×–×›××•×ª ×œ×”×‘×¨××” ××œ××”
      clothing: 2000, // ×‘×™×’×•×“ ×× ×”×œ×™×
      gifts: 800,   // ××ª× ×•×ª ×× ×”×œ×™× ××•×’×‘×¨×•×ª
      sickDays: 18, // ×™××™ ××—×œ×” ××œ××™×
      childSickDays: 8 // ×™××™ ××—×œ×ª ×™×œ×“ ××œ××™×
    },
    
    // × ×™×¦×•×œ ×”×©× ×” 2024
    currentYearUsage: {
      vacation: {
        used: 16,
        dates: [
          { startDate: "2024-02-12", endDate: "2024-02-16", days: 5, type: "×—×•×¤×©×” ×©× ×ª×™×ª" },
          { startDate: "2024-08-05", endDate: "2024-08-16", days: 10, type: "×—×•×¤×©×” ×¨×¦×™×¤×”" },
          { startDate: "2024-09-30", endDate: "2024-09-30", days: 1, type: "×™×•× ×™×•××•×œ×“×ª" }
        ]
      },
      recovery: {
        used: 7,
        dates: [
          { startDate: "2024-06-10", endDate: "2024-06-16", days: 7, type: "×”×‘×¨××” ××œ××”" }
        ]
      },
      sickDays: {
        used: 3,
        dates: [
          { date: "2024-01-22", type: "××—×œ×” ×¢×¦××™×ª" },
          { date: "2024-04-18", type: "××—×œ×” ×¢×¦××™×ª" },
          { date: "2024-07-30", type: "××—×œ×” ×¢×¦××™×ª" }
        ]
      },
      childSickDays: {
        used: 2,
        dates: [
          { date: "2024-03-12", childAge: 15, type: "××—×œ×ª ×™×œ×“" },
          { date: "2024-05-28", childAge: 17, type: "××—×œ×ª ×™×œ×“" }
        ]
      }
    },
    
    // ×™×ª×¨×•×ª ×¦×‘×•×¨×•×ª ××©× ×™× ×§×•×“××•×ª
    accumulatedBalance: {
      sickDays: 45, // ×™××™ ××—×œ×” ××¦×˜×‘×¨×™× ×¨×‘×™×
      vacation: 5   // ×—×•×¤×©×” ××•×¢×‘×¨×ª ××§×¡×™××œ×™×ª
    },
    
    // ×–×›××•×ª ××ª× ×•×ª ×œ×™×œ×“×™×
    childrenGifts: {
      eligibleChildren: 2, // ×¨×§ ×¢×“ ×’×™×œ 18
      giftStatus2024: {
        "×¨××© ×”×©× ×”": "× ××¡×¨",
        "×—× ×•×›×”": "× ××¡×¨",
        "×¤×¡×—": "×œ× ×¨×œ×•×•× ×˜×™ ×¢×“×™×™×Ÿ"
      }
    },
    
    // × ×ª×•× ×™ ××©××¨×•×ª ×•×©×¢×•×ª × ×•×¡×¤×•×ª (×× ×”×œ×™× ×¤×˜×•×¨×™×)
    workData: {
      monthlyHours: 160,
      overtimeThisMonth: 0, // ×¤×˜×•×¨ ××©×¢×•×ª × ×•×¡×¤×•×ª
      overtimeDetails: [],
      managementCompensation: true // ×–×›××™ ×œ×”×¤×’×” ×‘××§×•× ×©×¢×•×ª × ×•×¡×¤×•×ª
    }
  },
  
  "branch_temp": {
    // ×¤×¨×˜×™× ××™×©×™×™×
    id: "321654987",
    name: "× ×•×¢×” ×›×”×Ÿ",
    role: "×¤×§×™×“×ª ×¡× ×™×£ ×–×× ×™×ª",
    department: "×¡× ×™×£ ×—×™×¤×”",
    accessLevel: "basic",
    avatar: "× .×›",
    permissions: ["basic", "branch_basic"],
    employmentType: "temporary", // ×–×× ×™
    seniority: 6, // ×—×•×“×©×™×
    grade: 2,
    hireDate: "2024-04-01",
    
    // × ×ª×•× ×™ ××©×¤×—×” (×˜×•×¤×¡ 101)
    familyData: {
      maritalStatus: "× ×©×•××”",
      numberOfChildren: 1,
      childrenAges: [3],
      spouseDetails: { name: "×¢××™×ª ×›×”×Ÿ", birthYear: 1990 },
      lastUpdated: "2024-04-15"
    },
    
    // ×–×›××•×™×•×ª ×©× ×ª×™×•×ª ×œ×¤×™ ×•×ª×§ ×•×¡×•×’ ×”×¢×¡×§×”
    annualEntitlements: {
      vacation: 8, // ×™××™ ×—×•×¤×©×” ×—×œ×§×™×™× ×œ×–×× ×™ ×¢× ×•×ª×§
      recovery: 0, // ××™×Ÿ ×–×›××•×ª ×œ×”×‘×¨××”
      clothing: 600, // ×‘×™×’×•×“ ×—×œ×§×™
      gifts: 300, // ××ª× ×•×ª ××•×¤×—×ª×•×ª
      sickDays: 15, // ×™××™ ××—×œ×”
      childSickDays: 6 // ×™××™ ××—×œ×ª ×™×œ×“ ×—×œ×§×™×™×
    },
    
    // × ×™×¦×•×œ ×”×©× ×” 2024
    currentYearUsage: {
      vacation: {
        used: 3,
        dates: [
          { startDate: "2024-07-08", endDate: "2024-07-10", days: 3, type: "×—×•×¤×©×” ×©× ×ª×™×ª" }
        ]
      },
      recovery: { used: 0, dates: [] },
      sickDays: {
        used: 4,
        dates: [
          { date: "2024-05-15", type: "××—×œ×” ×¢×¦××™×ª" },
          { date: "2024-06-22", type: "××—×œ×” ×¢×¦××™×ª" },
          { date: "2024-08-07", type: "××—×œ×” ×¢×¦××™×ª" },
          { date: "2024-09-19", type: "××—×œ×” ×¢×¦××™×ª" }
        ]
      },
      childSickDays: {
        used: 2,
        dates: [
          { date: "2024-06-12", childAge: 3, type: "××—×œ×ª ×™×œ×“" },
          { date: "2024-08-25", childAge: 3, type: "××—×œ×ª ×™×œ×“" }
        ]
      }
    },
    
    // ×™×ª×¨×•×ª ×¦×‘×•×¨×•×ª ××©× ×™× ×§×•×“××•×ª
    accumulatedBalance: {
      sickDays: 0, // ×¢×•×‘×“×ª ×—×“×©×”
      vacation: 0  // ×¢×•×‘×“×ª ×—×“×©×”
    },
    
    // ×–×›××•×ª ××ª× ×•×ª ×œ×™×œ×“×™×
    childrenGifts: {
      eligibleChildren: 1,
      giftStatus2024: {
        "×¨××© ×”×©× ×”": "× ××¡×¨",
        "×—× ×•×›×”": "×××ª×™×Ÿ",
        "×¤×¡×—": "×œ× ×¨×œ×•×•× ×˜×™ ×¢×“×™×™×Ÿ"
      }
    },
    
    // × ×ª×•× ×™ ××©××¨×•×ª ×•×©×¢×•×ª × ×•×¡×¤×•×ª
    workData: {
      monthlyHours: 160,
      overtimeThisMonth: 5,
      overtimeDetails: [
        { date: "2024-10-03", hours: 2, rate: "125%", approved: true },
        { date: "2024-10-11", hours: 3, rate: "125%", approved: true }
      ]
    }
  },
  
  "tech": {
    // ×¤×¨×˜×™× ××™×©×™×™×
    id: "654321789",
    name: "×©×¨×” ×’×•×œ×“××Ÿ",
    role: "××¤×ª×—×ª ×ª×•×›× ×”",
    department: "×—×˜×™×‘×ª ×˜×›× ×•×œ×•×’×™×•×ª",
    accessLevel: "tech",
    avatar: "×©.×’",
    permissions: ["basic", "tech", "systems"],
    employmentType: "permanent", // ×§×‘×•×¢
    seniority: 48, // ×—×•×“×©×™× (4 ×©× ×™×)
    grade: 7,
    hireDate: "2020-10-01",
    
    // × ×ª×•× ×™ ××©×¤×—×” (×˜×•×¤×¡ 101)
    familyData: {
      maritalStatus: "×¨×•×•×§×”",
      numberOfChildren: 0,
      childrenAges: [],
      spouseDetails: null,
      lastUpdated: "2024-01-10"
    },
    
    // ×–×›××•×™×•×ª ×©× ×ª×™×•×ª ×œ×¤×™ ×•×ª×§ ×•×¡×•×’ ×”×¢×¡×§×”
    annualEntitlements: {
      vacation: 18, // ×™××™ ×—×•×¤×©×” - 1-5 ×©× ×™×
      recovery: 7,  // ×–×›××•×ª ×œ×”×‘×¨××” ××œ××”
      clothing: 1800, // ×‘×™×’×•×“ ××¤×ª×—×™× ××•×’×‘×¨
      gifts: 600,   // ××ª× ×•×ª ×˜×›× ×•×œ×•×’×™×”
      sickDays: 18, // ×™××™ ××—×œ×” ××œ××™×
      childSickDays: 0 // ××™×Ÿ ×™×œ×“×™×
    },
    
    // × ×™×¦×•×œ ×”×©× ×” 2024
    currentYearUsage: {
      vacation: {
        used: 10,
        dates: [
          { startDate: "2024-01-15", endDate: "2024-01-19", days: 5, type: "×—×•×¤×©×” ×©× ×ª×™×ª" },
          { startDate: "2024-05-20", endDate: "2024-05-24", days: 5, type: "×—×•×¤×©×” ×©× ×ª×™×ª" }
        ]
      },
      recovery: {
        used: 0,
        dates: []
      },
      sickDays: {
        used: 2,
        dates: [
          { date: "2024-03-18", type: "××—×œ×” ×¢×¦××™×ª" },
          { date: "2024-07-25", type: "××—×œ×” ×¢×¦××™×ª" }
        ]
      },
      childSickDays: { used: 0, dates: [] }
    },
    
    // ×™×ª×¨×•×ª ×¦×‘×•×¨×•×ª ××©× ×™× ×§×•×“××•×ª
    accumulatedBalance: {
      sickDays: 32, // ×™××™ ××—×œ×” ××¦×˜×‘×¨×™×
      vacation: 4   // ×—×•×¤×©×” ××•×¢×‘×¨×ª
    },
    
    // ×–×›××•×ª ××ª× ×•×ª ×œ×™×œ×“×™×
    childrenGifts: {
      eligibleChildren: 0,
      giftStatus2024: {}
    },
    
    // × ×ª×•× ×™ ××©××¨×•×ª ×•×©×¢×•×ª × ×•×¡×¤×•×ª (×“×¨×’×” ×’×‘×•×”×” - ×¤×˜×•×¨×”)
    workData: {
      monthlyHours: 160,
      overtimeThisMonth: 0, // ×¤×˜×•×¨×” ××©×¢×•×ª × ×•×¡×¤×•×ª
      overtimeDetails: [],
      managementCompensation: true // ×–×›××™×ª ×œ×”×¤×’×”
    }
  }
};

// Alias for backward compatibility
const userProfiles = employeeDatabase;

// Main chatbot page
app.get('/', (c) => {
  const userType = c.req.query('user') || 'call_center';
  const currentUser = userProfiles[userType] || userProfiles.call_center;
  
  return c.render(
    <div class="chat-container">
      {/* Chat Header */}
      <div class="chat-header">
        <div class="logo">
          <img src="https://page.gensparksite.com/v1/base64_upload/1c2cbdf24b458a240d8a4f579cd06d4d" 
               alt="×œ×•×’×• ×‘× ×§ ×“×™×¡×§×•× ×˜" 
               style="width: 55px; height: 55px; object-fit: contain;" />
        </div>
        <div class="title">
          <h1>×¦'××˜×‘×•×˜ ×‘× ×§ ×“×™×¡×§×•× ×˜</h1>
          <p>×¢×•×–×¨ ×”×™×“×¢ ×”×—×›× â€¢ "×‘×“×™×¡×§×•× ×˜ ××©×§×™×¢×™× ×‘×š!"</p>
        </div>
        <div class="user-info">
          <div class="user-badge">
            <div class="status-indicator"></div>
            <span>{currentUser.name}</span>
            <div style="font-size: 0.75rem; opacity: 0.9;">
              {currentUser.role}<br/>
              {currentUser.employmentType === 'permanent' ? 'ğŸŸ¢ ×§×‘×•×¢' : 
               currentUser.employmentType === 'temporary' ? 'ğŸŸ¡ ×–×× ×™' : 'ğŸ”µ ×©×¢×ª×™'} â€¢ 
              ×“×¨×’×” {currentUser.grade} â€¢ 
              {Math.floor(currentUser.seniority / 12) > 0 ? `${Math.floor(currentUser.seniority / 12)} ×©× ×™×` : `${currentUser.seniority} ×—×•×“×©×™×`}
            </div>
          </div>
        </div>
      </div>

      {/* Chat Messages */}
      <div class="chat-messages" id="chat-messages">
        {/* Welcome Message */}
        <div class="message message-assistant">
          <div class="message-avatar">×‘× ×§</div>
          <div class="message-content">
            <p class="message-text">
              ×©×œ×•× {currentUser.name}! ğŸ‘‹<br/>
              ×× ×™ ×¢×•×–×¨ ×”×™×“×¢ ×”×—×›× ×©×œ ×‘× ×§ ×“×™×¡×§×•× ×˜. <br/>
              ×–×™×”×™×ª×™ ××•×ª×š ×›<strong>{currentUser.employmentType === 'permanent' ? '×¢×•×‘×“ ×§×‘×•×¢' : 
              currentUser.employmentType === 'temporary' ? '×¢×•×‘×“ ×–×× ×™' : '×¢×•×‘×“ ×©×¢×ª×™'}</strong> ×‘{currentUser.department}.<br/>
              <strong>×‘×“×™×¡×§×•× ×˜ ××©×§×™×¢×™× ×‘×š!</strong> ×”×ª×©×•×‘×•×ª ×©×œ×™ ××•×ª×××•×ª ××™×©×™×ª ×œ×¡×˜×˜×•×¡ ×”×”×¢×¡×§×” ×•×œ×–×›×•×™×•×ª×™×š.<br/>
              <strong>××™×š ×× ×™ ×™×›×•×œ ×œ×¢×–×•×¨ ×œ×š ×”×™×•×? ğŸ˜Š</strong>
            </p>
            <div class="message-meta">
              <i class="fas fa-clock"></i>
              <span id="current-time"></span>
              <span>â€¢</span>
              <span>××—×•×‘×¨ ×›{currentUser.role}</span>
            </div>
          </div>
        </div>

        {/* Quick Actions */}
        <div class="quick-actions">
          <div class="quick-action" onclick="sendQuickMessage('××” ×©×¢×•×ª ×”×¢×‘×•×“×” ×”×¨×’×™×œ×•×ª?')">
            <i class="fas fa-clock"></i> ×©×¢×•×ª ×¢×‘×•×“×”
          </div>
          <div class="quick-action" onclick="sendQuickMessage('××™×š ××’×™×©×™× ×‘×§×©×” ×œ×—×•×¤×©×”?')">
            <i class="fas fa-calendar-alt"></i> ×—×•×¤×©×” ×©× ×ª×™×ª
          </div>
          <div class="quick-action" onclick="sendQuickMessage('× ×•×”×œ ×“×™×•×•×— ××—×œ×”')">
            <i class="fas fa-user-md"></i> ×“×™×•×•×— ××—×œ×”
          </div>
          <div class="quick-action" onclick="sendQuickMessage('××™×š ××‘×§×©×™× ×©×¢×•×ª × ×•×¡×¤×•×ª?')">
            <i class="fas fa-plus-circle"></i> ×©×¢×•×ª × ×•×¡×¤×•×ª
          </div>
          <div class="quick-action" onclick="sendQuickMessage('×–×›×•×™×•×ª ×”×•×¨×•×ª ×•×œ×™×“×”')">
            <i class="fas fa-baby"></i> ×–×›×•×™×•×ª ×”×•×¨×•×ª
          </div>
          <div class="quick-action" onclick="sendQuickMessage('×¢×‘×•×“×” ××¨×—×•×§')">
            <i class="fas fa-home"></i> ×¢×‘×•×“×” ××”×‘×™×ª
          </div>
          <div class="quick-action" onclick="sendQuickMessage('××™×š ×× ×•×”×œ ×§×•×‘×¥ ×”××©××¨×•×ª?')">
            <i class="fas fa-calendar-week"></i> ××¢×¨×›×ª ××©××¨×•×ª
          </div>
          <div class="quick-action" onclick="sendQuickMessage('××¢×¨×›×ª ×–×›××•×™×•×ª ×•× ×™×¦×•×œ')">
            <i class="fas fa-chart-line"></i> ×–×›×•×™×•×ª ×•× ×™×¦×•×œ
          </div>
          <div class="quick-action" onclick="sendQuickMessage('××¢×§×‘ ×™××™ ××—×œ×” ××•×œ ×–×›××•×ª')">
            <i class="fas fa-heartbeat"></i> ×™××™ ××—×œ×”
          </div>
          <div class="quick-action" onclick="sendQuickMessage('×˜×•×¤×¡ 101 × ×ª×•× ×™ ××©×¤×—×”')">
            <i class="fas fa-users"></i> ×˜×•×¤×¡ 101
          </div>
          <div class="quick-action" onclick="sendQuickMessage('× ×™×¦×•×œ ×—×•×¤×©×” ×¨×¦×™×¤×”')">
            <i class="fas fa-umbrella-beach"></i> ×—×•×¤×©×” ×¨×¦×™×¤×”
          </div>
          <div class="quick-action" onclick="sendQuickMessage('×–×›××•×ª ××ª× ×•×ª ×œ×™×œ×“×™×')">
            <i class="fas fa-gift"></i> ××ª× ×•×ª ×™×œ×“×™×
          </div>
          <div class="quick-action" onclick="sendQuickMessage('×–×›××•×ª ×—×•×“×©×™×ª ×©×¢×•×ª × ×•×¡×¤×•×ª')">
            <i class="fas fa-stopwatch"></i> ×©×¢×•×ª × ×•×¡×¤×•×ª
          </div>
        </div>
      </div>

      {/* Chat Input */}
      <div class="chat-input">
        <div class="input-container">
          <div class="input-wrapper">
            <textarea 
              id="chat-input"
              class="chat-textarea"
              placeholder="×©××œ ××•×ª×™ ×›×œ ×©××œ×” ××§×¦×•×¢×™×ª..."
              rows="1"
              onkeydown="handleKeyDown(event)"
            ></textarea>
            <button 
              id="send-button"
              class="send-button"
              onclick="sendMessage()"
              type="button"
            >
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  )
})

// ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ×—×™×©×•×‘ ×™×ª×¨×•×ª ×•×–×›××•×™×•×ª
function calculateVacationBalance(employee) {
  const entitled = employee.annualEntitlements.vacation + employee.accumulatedBalance.vacation;
  const used = employee.currentYearUsage.vacation.used;
  return {
    entitled,
    used, 
    remaining: entitled - used,
    details: employee.currentYearUsage.vacation.dates
  };
}

function calculateSickDaysBalance(employee) {
  const annualEntitlement = employee.annualEntitlements.sickDays;
  const accumulated = employee.accumulatedBalance.sickDays;
  const totalEntitled = Math.min(annualEntitlement + accumulated, 90); // ××§×¡×™××•× 90 ×™××™×
  const used = employee.currentYearUsage.sickDays.used;
  
  return {
    annualEntitlement,
    accumulated,
    totalEntitled,
    used,
    remaining: totalEntitled - used,
    details: employee.currentYearUsage.sickDays.dates
  };
}

function calculateChildSickDaysBalance(employee) {
  const entitled = employee.annualEntitlements.childSickDays;
  const used = employee.currentYearUsage.childSickDays.used;
  
  return {
    entitled,
    used,
    remaining: entitled - used,
    details: employee.currentYearUsage.childSickDays.dates,
    eligibleChildren: employee.familyData.numberOfChildren
  };
}

function calculateRecoveryBalance(employee) {
  const entitled = employee.annualEntitlements.recovery;
  const used = employee.currentYearUsage.recovery.used;
  
  return {
    entitled,
    used,
    remaining: entitled - used,
    details: employee.currentYearUsage.recovery.dates
  };
}

function calculateOvertimeStatus(employee) {
  const currentMonth = employee.workData.overtimeThisMonth;
  const maxMonthly = employee.grade <= 6 ? 25 : 15; // ××’×‘×œ×•×ª ×œ×¤×™ ×“×¨×’×”
  const isExempt = employee.grade >= 7 || employee.workData.managementCompensation;
  
  return {
    currentMonth,
    maxMonthly: isExempt ? 0 : maxMonthly,
    remaining: isExempt ? 0 : Math.max(0, maxMonthly - currentMonth),
    isExempt,
    details: employee.workData.overtimeDetails || []
  };
}

function getChildrenGiftStatus(employee) {
  return {
    eligibleChildren: employee.childrenGifts.eligibleChildren,
    childrenAges: employee.familyData.childrenAges,
    status2024: employee.childrenGifts.giftStatus2024
  };
}

function generatePersonalizedResponse(baseAnswer, employee, topic) {
  let personalSection = "\n\n**ğŸ“Š ×”××™×“×¢ ×”××™×©×™ ×©×œ×š:**\n";
  
  switch(topic) {
    case 'vacation':
      const vacBalance = calculateVacationBalance(employee);
      personalSection += `**×–×›××•×ª ×©× ×ª×™×ª:** ${vacBalance.entitled} ×™××™×\n`;
      personalSection += `**× ×™×¦×œ×ª ×”×©× ×”:** ${vacBalance.used} ×™××™×\n`;
      personalSection += `**×™×ª×¨×” ×–××™× ×”:** ${vacBalance.remaining} ×™××™×\n`;
      if (vacBalance.details.length > 0) {
        personalSection += `**×—×•×¤×©×•×ª ×©× ×œ×§×—×•:** ${vacBalance.details.map(d => `${d.startDate} (${d.days} ×™××™×)`).join(', ')}\n`;
      }
      break;
      
    case 'sick':
      const sickBalance = calculateSickDaysBalance(employee);
      personalSection += `**×–×›××•×ª ×©× ×ª×™×ª:** ${sickBalance.annualEntitlement} ×™××™×\n`;
      personalSection += `**×™×ª×¨×” ××¦×˜×‘×¨×ª:** ${sickBalance.accumulated} ×™××™×\n`;
      personalSection += `**×¡×”"×› ×–×›××•×ª:** ${sickBalance.totalEntitled} ×™××™×\n`;
      personalSection += `**× ×™×¦×œ×ª ×”×©× ×”:** ${sickBalance.used} ×™××™×\n`;
      personalSection += `**×™×ª×¨×” ×–××™× ×”:** ${sickBalance.remaining} ×™××™×\n`;
      break;
      
    case 'childSick':
      const childSickBalance = calculateChildSickDaysBalance(employee);
      personalSection += `**××¡×¤×¨ ×™×œ×“×™× ×–×›××™×:** ${childSickBalance.eligibleChildren}\n`;
      personalSection += `**×–×›××•×ª ×©× ×ª×™×ª:** ${childSickBalance.entitled} ×™××™×\n`;
      personalSection += `**× ×™×¦×œ×ª ×”×©× ×”:** ${childSickBalance.used} ×™××™×\n`;
      personalSection += `**×™×ª×¨×” ×–××™× ×”:** ${childSickBalance.remaining} ×™××™×\n`;
      break;
      
    case 'overtime':
      const overtimeStatus = calculateOvertimeStatus(employee);
      if (overtimeStatus.isExempt) {
        personalSection += `**×“×¨×’×” ${employee.grade}:** ×¤×˜×•×¨ ××©×¢×•×ª × ×•×¡×¤×•×ª, ×–×›××™ ×œ×”×¤×’×”\n`;
      } else {
        personalSection += `**×©×¢×•×ª × ×•×¡×¤×•×ª ×”×—×•×“×©:** ${overtimeStatus.currentMonth} ×©×¢×•×ª\n`;
        personalSection += `**××›×¡×” ×—×•×“×©×™×ª:** ${overtimeStatus.maxMonthly} ×©×¢×•×ª\n`;
        personalSection += `**×™×ª×¨×” ×–××™× ×”:** ${overtimeStatus.remaining} ×©×¢×•×ª\n`;
      }
      break;
      
    case 'gifts':
      const giftStatus = getChildrenGiftStatus(employee);
      personalSection += `**×™×œ×“×™× ×–×›××™×:** ${giftStatus.eligibleChildren}\n`;
      if (giftStatus.eligibleChildren > 0) {
        personalSection += `**×’×™×œ××™ ×”×™×œ×“×™×:** ${giftStatus.childrenAges.join(', ')}\n`;
        personalSection += `**×¡×˜×˜×•×¡ ××ª× ×•×ª 2024:**\n`;
        Object.entries(giftStatus.status2024).forEach(([holiday, status]) => {
          personalSection += `  â€¢ ${holiday}: ${status}\n`;
        });
      }
      break;
      
    case 'family':
      const family = employee.familyData;
      personalSection += `**×¡×˜×˜×•×¡ ××©×¤×—×ª×™:** ${family.maritalStatus}\n`;
      personalSection += `**××¡×¤×¨ ×™×œ×“×™×:** ${family.numberOfChildren}\n`;
      if (family.numberOfChildren > 0) {
        personalSection += `**×’×™×œ××™ ×™×œ×“×™×:** ${family.childrenAges.join(', ')}\n`;
      }
      personalSection += `**×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”:** ${family.lastUpdated}\n`;
      break;
      
    default:
      // ×ª×’×•×‘×” ×›×œ×œ×™×ª ×¢× ×¤×¨×˜×™ ×¢×•×‘×“
      personalSection += `**×¡×•×’ ×”×¢×¡×§×”:** ${employee.employmentType === 'permanent' ? '×§×‘×•×¢' : 
                                          employee.employmentType === 'temporary' ? '×–×× ×™' : '×©×¢×ª×™'}\n`;
      personalSection += `**×•×ª×§:** ${Math.floor(employee.seniority / 12)} ×©× ×™×, ${employee.seniority % 12} ×—×•×“×©×™×\n`;
      personalSection += `**×“×¨×’×”:** ${employee.grade}\n`;
  }
  
  return baseAnswer + personalSection;
}

// API endpoint for chat
app.post('/api/chat', async (c) => {
  try {
    const { message, userType = 'call_center' } = await c.req.json()
    const currentUser = userProfiles[userType] || userProfiles.call_center;
    
    // Simulate processing delay
    await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
    
    // Enhanced keyword matching for demo with personal data support
    const lowerMessage = message.toLowerCase();
    let matchedKnowledge = null;
    let personalTopic = null;
    
    // ×–×™×”×•×™ ×©××œ×•×ª ××™×©×™×•×ª ×¢× ×™×ª×¨×•×ª ×•×××’×¨ ××™×“×¢ ××•×ª×× ××™×©×™×ª
    const personalQuestions = {
      vacation: ['×›××” ×—×•×¤×©×” × ×©××¨×”', '×›××” ×™××™ ×—×•×¤×©×”', '×™×ª×¨×ª ×—×•×¤×©×”', '×—×•×¤×©×” ×©×œ×™', '×™××™ ×”×—×•×¤×©×” ×©×œ×™', '×™×ª×¨×ª ×™××™ ×—×•×¤×©×”', '×›××” ×—×•×¤×©×” ×™×© ×œ×™'],
      sick: ['×›××” ×™××™ ××—×œ×”', '×™×ª×¨×ª ××—×œ×”', '×™××™ ××—×œ×” ×©×œ×™', '×›××” ××—×œ×” × ×©××¨×”', '×™×ª×¨×ª ×™××™ ××—×œ×”'],
      childSick: ['××—×œ×ª ×™×œ×“', '×™××™ ××—×œ×ª ×™×œ×“ ×©×œ×™', '×›××” ×™××™ ××—×œ×ª ×™×œ×“', '×™×ª×¨×ª ××—×œ×ª ×™×œ×“'],
      overtime: ['×©×¢×•×ª × ×•×¡×¤×•×ª ×©×œ×™', '×›××” ×©×¢×•×ª × ×•×¡×¤×•×ª', '×™×ª×¨×ª ×©×¢×•×ª × ×•×¡×¤×•×ª', '××›×¡×ª ×©×¢×•×ª × ×•×¡×¤×•×ª'],
      gifts: ['××ª× ×•×ª ×œ×™×œ×“×™× ×©×œ×™', '××ª× ×•×ª ×”×™×œ×“×™×', '×¡×˜×˜×•×¡ ××ª× ×•×ª', '××ª× ×•×ª ×©×œ×™'],
      family: ['×˜×•×¤×¡ 101 ×©×œ×™', '× ×ª×•× ×™ ×”××©×¤×—×” ×©×œ×™', '×¤×¨×˜×™ ××©×¤×—×”', '×™×œ×“×™× ×©×œ×™', '××¦×‘ ××©×¤×—×ª×™']
    };
    
    // ×‘×“×™×§×” ×× ×–×• ×©××œ×” ××™×©×™×ª
    for (const [topic, keywords] of Object.entries(personalQuestions)) {
      if (keywords.some(keyword => lowerMessage.includes(keyword))) {
        personalTopic = topic;
        break;
      }
    }
    
    // Priority-based keyword matching - more specific first
    if (lowerMessage.includes('×—×•×¤×©×”') || lowerMessage.includes('×—×•×¤×©')) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('×—×•×¤×©×”'));
    } else if (lowerMessage.includes('××—×œ×”') || lowerMessage.includes('×—×•×œ×”')) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('××—×œ×”'));
    } else if ((lowerMessage.includes('×©×¢×•×ª') && lowerMessage.includes('× ×•×¡×¤×•×ª')) || lowerMessage.includes('×ª×’××•×œ')) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('×©×¢×•×ª × ×•×¡×¤×•×ª'));
    } else if ((lowerMessage.includes('×©×¢×•×ª') && lowerMessage.includes('×¢×‘×•×“×”')) || lowerMessage.includes('××©××¨×ª')) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('×©×¢×•×ª ×”×¢×‘×•×“×”'));
    } else if (lowerMessage.includes('×œ×™×“×”') || lowerMessage.includes('×”×•×¨×•×ª') || lowerMessage.includes('×”×¨×™×•×Ÿ')) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('×”×•×¨×•×ª'));
    } else if (lowerMessage.includes('×ª×œ×•× ×”') || lowerMessage.includes('×¤× ×™×™×”') || lowerMessage.includes('×‘×¢×™×”')) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('×ª×œ×•× ×”'));
    } else if (lowerMessage.includes('××¨×—×•×§') || lowerMessage.includes('×‘×™×ª') || lowerMessage.includes('×˜×œ×¢×‘×•×“×”')) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('××¨×—×•×§'));
    } else if (lowerMessage.includes('××™×©×•×¨') && lowerMessage.includes('×—×•×¤×©×”') && lowerMessage.includes('×× ×”×œ')) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('××™×©×•×¨ ×—×•×¤×©×”'));
    } else if (lowerMessage.includes('×¢××œ×”') || lowerMessage.includes('×—×™×•×‘') || lowerMessage.includes('×–×™×›×•×™')) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('×¢××œ×”'));
    } else if (lowerMessage.includes('×”×œ×•×•××”') || lowerMessage.includes('××©×¨××™') || lowerMessage.includes('××™××•×Ÿ')) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('×”×œ×•×•××”'));
    } else if (lowerMessage.includes('×’×™×©×”') || (lowerMessage.includes('××¢×¨×›×ª') && (lowerMessage.includes('×”×¨×©××”') || lowerMessage.includes('×œ×™×‘×”')))) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('×’×™×©×” ×œ××¢×¨×›×ª'));
    } else if (lowerMessage.includes('×¤×¢×™×œ×•×ª') && lowerMessage.includes('××¢×¨×›×•×ª')) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('×©×¢×•×ª ×”×¤×¢×™×œ×•×ª'));
    } else if (lowerMessage.includes('××©××¨×•×ª') || lowerMessage.includes('×§×•×‘×¥ ××©××¨×•×ª') || (lowerMessage.includes('××¢×¨×›×ª') && lowerMessage.includes('××©××¨×•×ª'))) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('×§×•×‘×¥ ×”××©××¨×•×ª'));
    } else if ((lowerMessage.includes('×–×›××•×™×•×ª') && lowerMessage.includes('× ×™×¦×•×œ')) || lowerMessage.includes('××¢×¨×›×ª ×–×›××•×™×•×ª')) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('××¢×¨×›×ª ×”×–×›××•×™×•×ª'));
    } else if (lowerMessage.includes('×˜×•×¤×¡ 101') || (lowerMessage.includes('× ×ª×•× ×™') && lowerMessage.includes('××©×¤×—×”'))) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('×˜×•×¤×¡ 101'));
    } else if ((lowerMessage.includes('×—×•×¤×©×”') && lowerMessage.includes('×¨×¦×™×¤×”')) || lowerMessage.includes('× ×™×¦×•×œ ×—×•×¤×©×”')) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('×—×•×¤×©×” ×¨×¦×™×¤×”'));
    } else if ((lowerMessage.includes('××ª× ×•×ª') && lowerMessage.includes('×™×œ×“×™×')) || lowerMessage.includes('×–×›××•×ª ××ª× ×•×ª')) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('××ª× ×•×ª ×œ×™×œ×“×™×'));
    } else if ((lowerMessage.includes('×–×›××•×ª') && lowerMessage.includes('×—×•×“×©×™×ª')) || (lowerMessage.includes('×—×•×“×©×™×ª') && lowerMessage.includes('×©×¢×•×ª'))) {
      matchedKnowledge = knowledgeBase.find(kb => kb.question.includes('×–×›××•×ª ×—×•×“×©×™×ª'));
    }
    
    // Fallback: try direct text similarity
    if (!matchedKnowledge) {
      for (const kb of knowledgeBase) {
        const similarity = calculateSimilarity(lowerMessage, kb.question.toLowerCase());
        if (similarity > 0.2) {
          matchedKnowledge = kb;
          break;
        }
      }
    }
    
    let response;
    
    // ×˜×™×¤×•×œ ×‘×©××œ×•×ª ××™×©×™×•×ª ×¢× × ×ª×•× ×™× ××”×××’×¨
    if (personalTopic) {
      let personalResponse = "";
      let sources = ["×××’×¨ × ×ª×•× ×™ ×¢×•×‘×“×™×", "××¢×¨×›×ª HR"];
      
      switch (personalTopic) {
        case 'vacation':
          const vacBalance = calculateVacationBalance(currentUser);
          personalResponse = `**ğŸ–ï¸ ×™×ª×¨×ª ×™××™ ×”×—×•×¤×©×” ×©×œ×š:**\n\n`;
          personalResponse += `ğŸ“… **×–×›××•×ª ×©× ×ª×™×ª:** ${vacBalance.entitled} ×™××™×\n`;
          personalResponse += `âœ… **× ×™×¦×œ×ª ×¢×“ ×›×”:** ${vacBalance.used} ×™××™×\n`;
          personalResponse += `ğŸ¯ **×™×ª×¨×” ×–××™× ×”:** **${vacBalance.remaining} ×™××™×**\n\n`;
          
          if (vacBalance.details.length > 0) {
            personalResponse += `**ğŸ“‹ ×—×•×¤×©×•×ª ×©× ×œ×§×—×• ×”×©× ×”:**\n`;
            vacBalance.details.forEach(d => {
              personalResponse += `â€¢ ${d.startDate} ×¢×“ ${d.endDate} (${d.days} ×™××™×) - ${d.type}\n`;
            });
          } else {
            personalResponse += `ğŸ’¡ **×¢×“×™×™×Ÿ ×œ× × ×œ×§×—×• ×—×•×¤×©×•×ª ×”×©× ×”!**\n`;
          }
          
          if (currentUser.employmentType === 'temporary' && currentUser.seniority < 6) {
            personalResponse += `\nâš ï¸ **×©×™× ×œ×‘:** ×›×¢×•×‘×“ ×–×× ×™ ×¢× ×•×ª×§ ××ª×—×ª ×œ-6 ×—×•×“×©×™×, ×™×™×ª×›×Ÿ ×©××™×Ÿ ×œ×š ×–×›××•×ª ××œ××” ×œ×—×•×¤×©×”.`;
          }
          break;
          
        case 'sick':
          const sickBalance = calculateSickDaysBalance(currentUser);
          personalResponse = `**ğŸ¥ ×™×ª×¨×ª ×™××™ ×”××—×œ×” ×©×œ×š:**\n\n`;
          personalResponse += `ğŸ“… **×–×›××•×ª ×©× ×ª×™×ª:** ${sickBalance.annualEntitlement} ×™××™×\n`;
          personalResponse += `ğŸ’¼ **×™×ª×¨×” ××¦×˜×‘×¨×ª:** ${sickBalance.accumulated} ×™××™×\n`;
          personalResponse += `ğŸ“Š **×¡×”"×› ×–×›××•×ª:** ${sickBalance.totalEntitled} ×™××™×\n`;
          personalResponse += `âœ… **× ×™×¦×œ×ª ×”×©× ×”:** ${sickBalance.used} ×™××™×\n`;
          personalResponse += `ğŸ¯ **×™×ª×¨×” ×–××™× ×”:** **${sickBalance.remaining} ×™××™×**\n\n`;
          
          if (sickBalance.details.length > 0) {
            personalResponse += `**ğŸ“‹ ×™××™ ××—×œ×” ×©× ×œ×§×—×• ×”×©× ×”:**\n`;
            sickBalance.details.forEach(d => {
              personalResponse += `â€¢ ${d.date} - ${d.type}\n`;
            });
          }
          
          if (sickBalance.remaining < 3) {
            personalResponse += `\nâš ï¸ **××–×”×¨×”:** × ×•×ª×¨×• ×œ×š ××¢×˜ ×™××™ ××—×œ×”. ×©×§×•×œ ×œ×©××•×¨ ×¢×œ ×”×–×›××•×ª ×œ×—×™×¨×•×.`;
          }
          break;
          
        case 'childSick':
          const childSickBalance = calculateChildSickDaysBalance(currentUser);
          personalResponse = `**ğŸ‘¶ ×™×ª×¨×ª ×™××™ ××—×œ×ª ×™×œ×“ ×©×œ×š:**\n\n`;
          personalResponse += `ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ **××¡×¤×¨ ×™×œ×“×™× ×–×›××™×:** ${childSickBalance.eligibleChildren}\n`;
          if (childSickBalance.eligibleChildren > 0) {
            personalResponse += `ğŸ“… **×–×›××•×ª ×©× ×ª×™×ª:** ${childSickBalance.entitled} ×™××™×\n`;
            personalResponse += `âœ… **× ×™×¦×œ×ª ×”×©× ×”:** ${childSickBalance.used} ×™××™×\n`;
            personalResponse += `ğŸ¯ **×™×ª×¨×” ×–××™× ×”:** **${childSickBalance.remaining} ×™××™×**\n`;
            personalResponse += `ğŸ‚ **×’×™×œ××™ ×”×™×œ×“×™×:** ${currentUser.familyData.childrenAges.join(', ')}\n`;
          } else {
            personalResponse += `\nğŸ’¡ **××™×Ÿ ×œ×š ×™×œ×“×™× ×¨×©×•××™× ×‘××¢×¨×›×ª ××• ×©×”× ××¢×œ ×’×™×œ 18.**`;
          }
          break;
          
        case 'overtime':
          const overtimeStatus = calculateOvertimeStatus(currentUser);
          personalResponse = `**â° ××¦×‘ ×©×¢×•×ª × ×•×¡×¤×•×ª ×©×œ×š:**\n\n`;
          if (overtimeStatus.isExempt) {
            personalResponse += `ğŸ‘” **×“×¨×’×” ${currentUser.grade}:** ×¤×˜×•×¨ ××©×¢×•×ª × ×•×¡×¤×•×ª\n`;
            personalResponse += `ğŸ’° **×–×›××•×ª:** ×”×¤×’×”/×ª×•×¡×¤×ª × ×™×”×•×œ×™×ª ×‘××§×•× ×©×¢×•×ª × ×•×¡×¤×•×ª\n`;
          } else {
            personalResponse += `â±ï¸ **×©×¢×•×ª × ×•×¡×¤×•×ª ×”×—×•×“×©:** ${overtimeStatus.currentMonth} ×©×¢×•×ª\n`;
            personalResponse += `ğŸ“Š **××›×¡×” ×—×•×“×©×™×ª ××•×ª×¨×ª:** ${overtimeStatus.maxMonthly} ×©×¢×•×ª\n`;
            personalResponse += `ğŸ¯ **×™×ª×¨×” ×–××™× ×”:** **${overtimeStatus.remaining} ×©×¢×•×ª**\n\n`;
            
            if (overtimeStatus.details.length > 0) {
              personalResponse += `**ğŸ“‹ ×©×¢×•×ª × ×•×¡×¤×•×ª ×”×—×•×“×©:**\n`;
              overtimeStatus.details.forEach(d => {
                personalResponse += `â€¢ ${d.date}: ${d.hours} ×©×¢×•×ª (${d.rate}) - ${d.approved ? 'âœ… ×××•×©×¨' : 'â³ ×××ª×™×Ÿ ×œ××™×©×•×¨'}\n`;
              });
            }
          }
          break;
          
        case 'gifts':
          const giftStatus = getChildrenGiftStatus(currentUser);
          personalResponse = `**ğŸ ××¦×‘ ××ª× ×•×ª ×œ×™×œ×“×™× ×©×œ×š:**\n\n`;
          personalResponse += `ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ **×™×œ×“×™× ×–×›××™×:** ${giftStatus.eligibleChildren}\n`;
          
          if (giftStatus.eligibleChildren > 0) {
            personalResponse += `ğŸ‚ **×’×™×œ××™ ×”×™×œ×“×™×:** ${giftStatus.childrenAges.join(', ')}\n\n`;
            personalResponse += `**ğŸ“… ×¡×˜×˜×•×¡ ××ª× ×•×ª 2024:**\n`;
            Object.entries(giftStatus.status2024).forEach(([holiday, status]) => {
              const statusEmoji = status === '× ××¡×¨' ? 'âœ…' : status === '×××ª×™×Ÿ' ? 'â³' : 'â“';
              personalResponse += `â€¢ ${holiday}: ${statusEmoji} ${status}\n`;
            });
          } else {
            personalResponse += `\nğŸ’¡ **××™×Ÿ ×œ×š ×™×œ×“×™× ×–×›××™× ×œ××ª× ×•×ª (×¢×“ ×’×™×œ 18).**`;
          }
          break;
          
        case 'family':
          const family = currentUser.familyData;
          personalResponse = `**ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ×”×˜×•×¤×¡ 101 - × ×ª×•× ×™ ×”××©×¤×—×” ×©×œ×š:**\n\n`;
          personalResponse += `ğŸ’‘ **×¡×˜×˜×•×¡ ××©×¤×—×ª×™:** ${family.maritalStatus}\n`;
          personalResponse += `ğŸ‘¶ **××¡×¤×¨ ×™×œ×“×™×:** ${family.numberOfChildren}\n`;
          
          if (family.numberOfChildren > 0) {
            personalResponse += `ğŸ‚ **×’×™×œ××™ ×™×œ×“×™×:** ${family.childrenAges.join(', ')}\n`;
            personalResponse += `ğŸ **×™×œ×“×™× ×–×›××™× ×œ××ª× ×•×ª:** ${family.childrenAges.filter(age => age <= 18).length}\n`;
            personalResponse += `ğŸ¥ **×™×œ×“×™× ×–×›××™× ×œ××—×œ×ª ×™×œ×“:** ${family.childrenAges.filter(age => age <= 16).length}\n`;
          }
          
          personalResponse += `ğŸ“… **×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”:** ${family.lastUpdated}\n`;
          
          const nextUpdate = new Date('2025-01-31');
          const today = new Date();
          if (today > nextUpdate) {
            personalResponse += `\nâš ï¸ **×“×¨×•×© ×¢×“×›×•×Ÿ:** ×”×˜×•×¤×¡ ×¦×¨×™×š ×¢×“×›×•×Ÿ ×¢×“ 31.1 ×‘×›×œ ×©× ×”!`;
          } else {
            personalResponse += `\nâœ… **×”×˜×•×¤×¡ ×¢×“×›× ×™** - ×”×¢×“×›×•×Ÿ ×”×‘× × ×“×¨×© ×¢×“ 31.1.2025`;
          }
          break;
      }
      
      response = {
        text: personalResponse,
        sources: sources,
        lastUpdated: new Date().toISOString().split('T')[0],
        confidence: 1.0,
        personalized: true,
        personalData: true,
        userType: currentUser.employmentType,
        userSeniority: `${Math.floor(currentUser.seniority / 12)} ×©× ×™×, ${currentUser.seniority % 12} ×—×•×“×©×™×`
      };
      
    } else if (matchedKnowledge) {
      // Check access permissions
      const hasAccess = currentUser.permissions.includes(matchedKnowledge.accessLevel);
      
      if (hasAccess) {
        // Customize answer based on user's employment status
        const customizedAnswer = customizeAnswerForUser(
          matchedKnowledge.answer, 
          currentUser, 
          matchedKnowledge.id
        );
        
        response = {
          text: customizedAnswer,
          sources: matchedKnowledge.sources,
          lastUpdated: matchedKnowledge.lastUpdated,
          confidence: 0.95,
          personalized: true,
          userType: currentUser.employmentType,
          userSeniority: `${Math.floor(currentUser.seniority / 12)} ×©× ×™×, ${currentUser.seniority % 12} ×—×•×“×©×™×`
        };
      } else {
        response = {
          text: "××¦×˜×¢×¨, ××™×Ÿ ×œ×š ×”×¨×©××” ×œ×’×©×ª ×œ××™×“×¢ ×–×”. ×× × ×¤× ×” ×œ×× ×”×œ ×”×™×©×™×¨ ×©×œ×š ××• ×œ××•×§×“ IT ×œ×§×‘×œ×ª ×”×¨×©××•×ª × ×•×¡×¤×•×ª.",
          sources: [],
          lastUpdated: new Date().toISOString().split('T')[0],
          confidence: 1.0
        };
      }
    } else {
      response = {
        text: "××¦×˜×¢×¨, ×œ× ××¦××ª×™ ××™×“×¢ ×¨×œ×•×•× ×˜×™ ×œ×©××œ×ª×š ×‘×××’×¨×™ ×”×™×“×¢ ×”×××•×©×¨×™×. ××•××œ×¥ ×œ×¤× ×•×ª ×œ×’×•×¨× ×”××§×¦×•×¢×™ ×”×¨×œ×•×•× ×˜×™ ××• ×œ×‘×“×•×§ ×‘××¢×¨×›×•×ª ×”×¤× ×™××™×•×ª ×”×¢×“×›× ×™×•×ª.",
        sources: [],
        lastUpdated: new Date().toISOString().split('T')[0],
        confidence: 0.0
      };
    }
    
    return c.json(response)
  } catch (error) {
    return c.json({ error: '×©×’×™××” ×‘×¢×™×‘×•×“ ×”×‘×§×©×”' }, 500)
  }
})

// Helper function for text similarity (simple word overlap)
function calculateSimilarity(text1: string, text2: string): number {
  const words1 = text1.split(' ').filter(w => w.length > 2);
  const words2 = text2.split(' ').filter(w => w.length > 2);
  const commonWords = words1.filter(w => words2.includes(w));
  return commonWords.length / Math.max(words1.length, words2.length);
}

// Function to customize answers based on employment status
function customizeAnswerForUser(answer: string, user: any, questionId: number): string {
  let customizedAnswer = answer;
  
  // Customize vacation/leave answers based on employment type
  if (questionId === 6) { // ×—×•×¤×©×” ×©× ×ª×™×ª
    const vacationRights = getVacationRights(user);
    customizedAnswer = `${answer}\n\n**ğŸ¯ ×–×›×•×™×•×ª×™×š ×”××™×©×™×•×ª:**\n${vacationRights}`;
  } else if (questionId === 7) { // ×“×™×•×•×— ××—×œ×”
    const sickLeaveRights = getSickLeaveRights(user);
    customizedAnswer = `${answer}\n\n**ğŸ¯ ×–×›×•×™×•×ª×™×š ×”××™×©×™×•×ª:**\n${sickLeaveRights}`;
  } else if (questionId === 8) { // ×©×¢×•×ª × ×•×¡×¤×•×ª
    const overtimeRights = getOvertimeRights(user);
    customizedAnswer = `${answer}\n\n**ğŸ¯ ×–×›×•×™×•×ª×™×š ×”××™×©×™×•×ª:**\n${overtimeRights}`;
  } else if (questionId === 5) { // ×©×¢×•×ª ×¢×‘×•×“×”
    const workHours = getPersonalWorkHours(user);
    customizedAnswer = `${answer}\n\n**ğŸ¯ ××©××¨×•×ª×™×š:**\n${workHours}`;
  }
  
  return customizedAnswer;
}

// Get vacation rights based on employment type and seniority
function getVacationRights(user: any): string {
  const seniorityYears = Math.floor(user.seniority / 12);
  
  switch (user.employmentType) {
    case 'permanent':
      if (seniorityYears < 1) return "**×¢×•×‘×“ ×§×‘×•×¢ ×—×“×©:** 12 ×™××™ ×—×•×¤×©×” ×‘×©× ×” ×”×¨××©×•× ×”, 18 ×™××™× ××”×©× ×” ×”×©× ×™×™×”.";
      else if (seniorityYears < 5) return "**×¢×•×‘×“ ×§×‘×•×¢ (1-5 ×©× ×™×):** 18 ×™××™ ×—×•×¤×©×” ×‘×©× ×” + ×™×•× ×™×•××•×œ×“×ª.";
      else if (seniorityYears < 10) return "**×¢×•×‘×“ ×§×‘×•×¢ ×•×ª×™×§ (5-10 ×©× ×™×):** 21 ×™××™ ×—×•×¤×©×” ×‘×©× ×” + ×™×•× ×™×•××•×œ×“×ª + ×™×•× ××ª× ×”.";
      else return "**×¢×•×‘×“ ×§×‘×•×¢ ×‘×›×™×¨ (10+ ×©× ×™×):** 24 ×™××™ ×—×•×¤×©×” ×‘×©× ×” + ×™×•× ×™×•××•×œ×“×ª + ×™×•× ××ª× ×” + ×—×•×¤×©×” × ×•×¡×¤×ª.";
      
    case 'temporary':
      const monthsWorked = user.seniority;
      if (monthsWorked < 6) return "**×¢×•×‘×“ ×–×× ×™:** ××™×Ÿ ×–×›××•×ª ×œ×—×•×¤×©×” ×©× ×ª×™×ª ×‘×—×•×“×©×™× ×”×¨××©×•× ×™×. ×–×›××™ ×œ×—×•×¤×© ×œ×œ× ×ª×©×œ×•× ×‘×ª×™××•×.";
      else if (monthsWorked < 12) return "**×¢×•×‘×“ ×–×× ×™ (6+ ×—×•×“×©×™×):** ×–×›××™ ×œ-1 ×™×•× ×—×•×¤×©×” ×œ×›×œ ×—×•×“×© ×¢×‘×•×“×” (××§×¡×™××•× 6 ×™××™×).";
      else return "**×¢×•×‘×“ ×–×× ×™ (×©× ×”+):** ×–×›××™ ×œ-12 ×™××™ ×—×•×¤×©×” ×‘×©× ×” (×¤×¨×•-×¨×˜×” ×œ×¤×™ ×ª×§×•×¤×ª ×”×”×¢×¡×§×”).";
      
    case 'hourly':
      return "**×¢×•×‘×“ ×©×¢×ª×™:** ×–×›××™ ×œ×—×•×¤×© ×œ×œ× ×ª×©×œ×•× ×‘×”×ª×¨××” ×©×œ 14 ×™×•×. ××™×Ÿ ×–×›××•×ª ×œ×—×•×¤×©×” ×‘×ª×©×œ×•×.";
      
    default:
      return "×¤× ×” ×œ××©××‘×™ ×× ×•×© ×œ×‘×™×¨×•×¨ ×–×›×•×™×•×ª×™×š ×”××“×•×™×§×•×ª.";
  }
}

// Get sick leave rights based on employment type
function getSickLeaveRights(user: any): string {
  switch (user.employmentType) {
    case 'permanent':
      return "**×¢×•×‘×“ ×§×‘×•×¢:** 18 ×™××™ ××—×œ×” ×‘×©× ×” (××¦×˜×‘×¨×™× ×¢×“ 90 ×™×•×) + 8 ×™××™ ××—×œ×ª ×™×œ×“. ×ª×©×œ×•× 100% ××”×©×›×¨.";
    case 'temporary':
      const monthsWorked = user.seniority;
      if (monthsWorked < 6) return "**×¢×•×‘×“ ×–×× ×™:** 6 ×™××™ ××—×œ×” ×‘×©× ×” ×‘×œ×‘×“. ×ª×©×œ×•× 75% ××”×©×›×¨ ×”×™×•××™.";
      else return "**×¢×•×‘×“ ×–×× ×™ (6+ ×—×•×“×©×™×):** 12 ×™××™ ××—×œ×” ×‘×©× ×” + 4 ×™××™ ××—×œ×ª ×™×œ×“. ×ª×©×œ×•× 85% ××”×©×›×¨.";
    case 'hourly':
      return "**×¢×•×‘×“ ×©×¢×ª×™:** ××™×Ÿ ×–×›××•×ª ×œ×™××™ ××—×œ×” ×‘×ª×©×œ×•×. ×–×›××™ ×œ××™×©×•×¨ ×¨×•×¤× ×œ×‘×™×˜×•×— ×œ××•××™ ×‘×œ×‘×“.";
    default:
      return "×¤× ×” ×œ××©××‘×™ ×× ×•×© ×œ×‘×™×¨×•×¨ ×–×›×•×™×•×ª×™×š ×”××“×•×™×§×•×ª.";
  }
}

// Get overtime rights based on grade and employment type
function getOvertimeRights(user: any): string {
  if (user.employmentType === 'hourly') {
    return "**×¢×•×‘×“ ×©×¢×ª×™:** ×©×¢×•×ª × ×•×¡×¤×•×ª ××¢×‘×¨ ×œ-8 ×©×¢×•×ª ×™×•××™×•×ª ×‘×ª×•×¡×¤×ª 25%. ××¢×‘×¨ ×œ-10 ×©×¢×•×ª ×™×•××™×•×ª ×‘×ª×•×¡×¤×ª 50%.";
  }
  
  if (user.grade >= 7) {
    return `**×“×¨×’×” ${user.grade}:** ×¤×˜×•×¨ ××©×¢×•×ª × ×•×¡×¤×•×ª. ×–×›××™ ×œ×”×¤×’×” ××• ×¤×™×¦×•×™ ×‘×”×ª×× ×œ× ×”×œ×™ ×”×—×‘×¨×”.`;
  } else {
    const rate = user.employmentType === 'permanent' ? '125%-150%' : '110%-125%';
    const maxHours = user.employmentType === 'permanent' ? '20 ×©×¢×•×ª' : '10 ×©×¢×•×ª';
    return `**×“×¨×’×” ${user.grade}:** ×ª×©×œ×•× ${rate} ×œ×¤×™ ×™×•× ×”×©×‘×•×¢. ××’×‘×œ×” ×—×•×“×©×™×ª: ${maxHours}.`;
  }
}

// Get personal work hours based on role and employment type
function getPersonalWorkHours(user: any): string {
  if (user.role.includes('××•×§×“')) {
    const shifts = user.employmentType === 'permanent' ? 
      "××©××¨×•×ª ×§×‘×•×¢×•×ª: 07:00-15:00 ××• 13:00-21:00 (×œ×¤×™ ×‘×—×™×¨×”)" :
      "××©××¨×•×ª ××©×ª× ×•×ª: 07:00-15:00, 13:00-21:00, 15:00-23:00 (×œ×¤×™ ×¦×•×¨×š)";
    return shifts;
  } else if (user.role.includes('×¡× ×™×£')) {
    return user.employmentType === 'permanent' ? 
      "×©×¢×•×ª ×¡× ×™×£ ×§×‘×•×¢×•×ª + ××©××¨×•×ª ×¢×¨×‘ ×œ×¤×™ ×ª×•×¨× ×•×ª" :
      "×©×¢×•×ª ×¡× ×™×£ ×‘×œ×‘×“, ×œ×œ× ××©××¨×•×ª ×¢×¨×‘";
  } else {
    return user.employmentType === 'permanent' ?
      "×©×¢×•×ª ××˜×”: 08:00-17:00 ×¢× ×’××™×©×•×ª ××œ××”" :
      "×©×¢×•×ª ×§×‘×•×¢×•×ª: 08:30-16:30 ×œ×œ× ×’××™×©×•×ª";
  }
}

// User switching endpoint
app.get('/switch/:userType', (c) => {
  const userType = c.req.param('userType');
  return c.redirect(`/?user=${userType}`);
})

// SSO Simulation page
app.get('/login', (c) => {
  return c.render(
    <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--boi-navy), var(--boi-blue));">
      <div class="card" style="max-width: 500px; width: 100%; margin: 2rem;">
        <div class="card-header" style="text-align: center;">
          <div style="font-size: 3.5rem; margin-bottom: 1rem;">
            <i class="fas fa-piggy-bank" style="color: var(--discount-accent);"></i>
          </div>
          <h1 style="margin: 0; font-size: 1.75rem; color: white; font-weight: 700;">×‘× ×§ ×“×™×¡×§×•× ×˜</h1>
          <p style="margin: 0.5rem 0 0 0; color: rgba(255,255,255,0.9); font-weight: 500;">××¢×¨×›×ª ×–×™×”×•×™ ×¤× ×™×-××¨×’×•× ×™ â€¢ "×‘×“×™×¡×§×•× ×˜ ××©×§×™×¢×™× ×‘×š!"</p>
        </div>
        <div class="card-body" style="text-align: center;">
          <h2 style="color: var(--boi-navy); margin-bottom: 1.5rem;">×‘×—×¨ ××ª ×¤×¨×•×¤×™×œ ×”××©×ª××©</h2>
          <p style="color: var(--boi-gray-600); margin-bottom: 2rem;">
            ×œ×¦×•×¨×›×™ ×”×“××•, ×‘×—×¨ ××ª ×¡×•×’ ×”××©×ª××© ×©×‘×¨×¦×•× ×š ×œ×“××•×ª:
          </p>
          
          <div style="display: flex; flex-direction: column; gap: 1rem;">
            
            <h3 style="color: var(--boi-navy); margin: 1.5rem 0 0.75rem 0; border-bottom: 2px solid var(--boi-gold); padding-bottom: 0.5rem;">
              <i class="fas fa-headset"></i> ×¢×•×‘×“×™ ××•×§×“ ×˜×œ×¤×•× ×™
            </h3>
            
            <a href="/?user=call_center_temp" class="btn btn-secondary" style="text-decoration: none; padding: 1rem;">
              <i class="fas fa-user-clock"></i>
              ××•×¨ ×™×©×¨××œ×™ - × ×¦×™×’ ××•×§×“ ×–×× ×™
              <small style="display: block; opacity: 0.8; font-weight: normal;">×–×× ×™ â€¢ 3 ×—×•×“×©×™× â€¢ ×–×›×•×™×•×ª ××•×’×‘×œ×•×ª</small>
            </a>
            
            <a href="/?user=call_center" class="btn btn-primary" style="text-decoration: none; padding: 1rem;">
              <i class="fas fa-headset"></i>
              ×¨×—×œ ×›×”×Ÿ - × ×¦×™×’×ª ××•×§×“ ×©×¢×ª×™×ª
              <small style="display: block; opacity: 0.8; font-weight: normal;">×©×¢×ª×™ â€¢ 8 ×—×•×“×©×™× â€¢ ×œ×œ× ×—×•×¤×©×” ×‘×ª×©×œ×•×</small>
            </a>
            
            <a href="/?user=call_center_permanent" class="btn btn-primary" style="text-decoration: none; padding: 1rem;">
              <i class="fas fa-user-tie"></i>
              ××™×›×œ ××‘×¨×”× - × ×¦×™×’×ª ××•×§×“ ×‘×›×™×¨×”
              <small style="display: block; opacity: 0.8; font-weight: normal;">×§×‘×•×¢ â€¢ 3 ×©× ×™× â€¢ ×–×›×•×™×•×ª ××œ××•×ª</small>
            </a>
            
            <h3 style="color: var(--boi-navy); margin: 1.5rem 0 0.75rem 0; border-bottom: 2px solid var(--boi-gold); padding-bottom: 0.5rem;">
              <i class="fas fa-building"></i> ×¢×•×‘×“×™ ×¡× ×™×¤×™×
            </h3>
            
            <a href="/?user=branch_temp" class="btn btn-secondary" style="text-decoration: none; padding: 1rem;">
              <i class="fas fa-user-clock"></i>
              × ×•×¢×” ×›×”×Ÿ - ×¤×§×™×“×ª ×¡× ×™×£ ×–×× ×™×ª
              <small style="display: block; opacity: 0.8; font-weight: normal;">×–×× ×™ â€¢ 6 ×—×•×“×©×™× â€¢ ×”×¨×©××•×ª ×‘×¡×™×¡×™×•×ª</small>
            </a>
            
            <a href="/?user=branch" class="btn btn-primary" style="text-decoration: none; padding: 1rem;">
              <i class="fas fa-building"></i>
              ×“×•×“ ×œ×•×™ - ×× ×”×œ ×¡× ×™×£
              <small style="display: block; opacity: 0.8; font-weight: normal;">×§×‘×•×¢ â€¢ 7 ×©× ×™× â€¢ ×”×¨×©××•×ª × ×™×”×•×œ ××œ××•×ª</small>
            </a>
            
            <h3 style="color: var(--boi-navy); margin: 1.5rem 0 0.75rem 0; border-bottom: 2px solid var(--boi-gold); padding-bottom: 0.5rem;">
              <i class="fas fa-laptop-code"></i> ×¦×•×•×ª ×˜×›× ×•×œ×•×’×™×•×ª
            </h3>
            
            <a href="/?user=tech" class="btn btn-primary" style="text-decoration: none; padding: 1rem;">
              <i class="fas fa-code"></i>
              ×©×¨×” ×’×•×œ×“××Ÿ - ××¤×ª×—×ª ×ª×•×›× ×”
              <small style="display: block; opacity: 0.8; font-weight: normal;">×§×‘×•×¢ â€¢ 4 ×©× ×™× â€¢ ×”×¨×©××•×ª ×˜×›× ×™×•×ª ××œ××•×ª</small>
            </a>
          </div>
          
          <div style="margin-top: 2rem; padding: 1rem; background: var(--boi-light-blue); border-radius: 0.5rem;">
            <h4 style="color: var(--boi-navy); margin: 0 0 0.5rem 0;">ğŸ’¡ ×˜×™×¤ ×œ×“××•:</h4>
            <p style="margin: 0; font-size: 0.875rem; color: var(--boi-gray-700);">
              ×›×œ ×¡×•×’ ××©×ª××© ×¨×•××” ×ª×©×•×‘×•×ª ××•×ª×××•×ª ×œ×ª×¤×§×™×“×• ×•×œ×”×¨×©××•×ª ×”×’×™×©×” ×©×œ×•.
              × ×¡×” ×œ×©××•×œ ××ª ××•×ª×” ×”×©××œ×” ×××©×ª××©×™× ×©×•× ×™×!
            </p>
          </div>
        </div>
      </div>
    </div>
  )
})

export default app
